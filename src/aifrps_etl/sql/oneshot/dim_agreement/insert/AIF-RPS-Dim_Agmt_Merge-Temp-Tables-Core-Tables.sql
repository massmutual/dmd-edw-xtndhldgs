--Take backups before merging for dim  agmt

select copy_table ('edw_tdsunset.dim_agreement', 'edw_tdsunset.dim_agreement_08222021_before_aifrps_initial_merge');

--since no records for RPS for dim agreement in PROD , its a direct merge 

INSERT INTO EDW_TDSUNSET.DIM_AGREEMENT
(
    DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    AGREEMENT_EFFECTIVE_DT,
    ISSUE_DT,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    SOURCE_PLAN_TYPE_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SOURCE_READABILITY_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_DELETE_IND,
    SOURCE_AGREEMENT_NR,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    SOURCE_PRODUCT_TYPE_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    LIVING_BENEFIT_NOTICE_CDE,
    SOURCE_LIVING_BENEFIT_NOTICE_CDE,
    LIVING_BENEFIT_LOCK_IN_CDE,
    SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
    LIVING_BENEFIT_LOCK_IN_DT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    APL_CDE,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    CONVERSION_EXPIRED_IND, --ADD THIS FIELD, BUT NOT INCLUDE IN CHECK-SUM
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    FACE_AMT,
    EXCHANGE_PROVISION_CDE,
    SOURCE_EXCHANGE_PROVISION_CDE,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_CDE,
    SOURCE_MEC_CDE,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
    PERSISTENCY_CREDIT_CDE,
    SOURCE_PERSISTENCY_CREDIT_CDE,
    PERSISTENCY_CREDIT_START_DT,
    DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    BEGIN_DT,
    BEGIN_DTM,
    ROW_PROCESS_DTM,
    AUDIT_ID,
    UPDATE_AUDIT_ID,
    LOGICAL_DELETE_IND,
    CHECK_SUM,
    CURRENT_ROW_IND,
    END_DT,
    END_DTM,
    SOURCE_SYSTEM_ID,
    RESTRICTED_ROW_IND
)
SELECT
    DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    AGREEMENT_EFFECTIVE_DT,
    ISSUE_DT,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    SOURCE_PLAN_TYPE_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SOURCE_READABILITY_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_DELETE_IND,
    SOURCE_AGREEMENT_NR,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    SOURCE_PRODUCT_TYPE_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    LIVING_BENEFIT_NOTICE_CDE,
    SOURCE_LIVING_BENEFIT_NOTICE_CDE,
    LIVING_BENEFIT_LOCK_IN_CDE,
    SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
    LIVING_BENEFIT_LOCK_IN_DT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    APL_CDE,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    CONVERSION_EXPIRED_IND, --ADD THIS FIELD, BUT NOT INCLUDE IN CHECK-SUM
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    FACE_AMT,
    EXCHANGE_PROVISION_CDE,
    SOURCE_EXCHANGE_PROVISION_CDE,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_CDE,
    SOURCE_MEC_CDE,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
    PERSISTENCY_CREDIT_CDE,
    SOURCE_PERSISTENCY_CREDIT_CDE,
    PERSISTENCY_CREDIT_START_DT,
    DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    BEGIN_DT,
    BEGIN_DTM,
    ROW_PROCESS_DTM,
    AUDIT_ID,
    UPDATE_AUDIT_ID,
    LOGICAL_DELETE_IND,
    CHECK_SUM,
    CURRENT_ROW_IND,
    END_DT,
    END_DTM,
    SOURCE_SYSTEM_ID,
    RESTRICTED_ROW_IND
FROM EDW_TDSUNSET.DIM_AGREEMENT_INITIAL_AIF_RPS;

commit;