/*
		FILENAME: aifrps_dim_agreement.sql
		AUTHOR: Siva
		SUBJECT AREA : AGREEMENT
		SOURCE: AIF-RPS
		TERADATA SOURCE CODE:
		DESCRIPTION: DIM_AGREEMENT TABLE POPULATION
		JIRA:
		CREATE DATE:2021-07-08
		===============================================================================================================
		VERSION/JIRA STORY#			CREATED BY          LAST_MODIFIED_DATE		DESCRIPTION
		---------------------------------------------------------------------------------------------------------------
		1.0 					AGREEMENT TIER-2    2021-07-06			FIRST VERSION OF DDL FOR TIER-2

 ---------------------------------------------------------------------------------------------------------------
*/

TRUNCATE TABLE EDW_WORK.AIFRPS_DIM_AGREEMENT;
TRUNCATE TABLE EDW_STAGING.AIFRPS_DIM_AGREEMENT_PRE_WORK;

-- Step 1: edw_staging.source => edw_staging.pre_work, business logic done here.
INSERT INTO EDW_STAGING.AIFRPS_DIM_AGREEMENT_PRE_WORK
(
    DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    MASTER_CONTRACT_GROUP_ID,
    SPONSOR_ID,
    PLAN_ID,
    SUBSCRIBER_ID,
    PARTICIPANT_ID,
    ICU_ID,
    MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC,
    PLAN_NM_1_TXT,
    PLAN_NM_2_TXT,
    PLAN_NM_3_TXT,
    SUBSCRIBER_NR,
    AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    ALLOW_ROLLOVER_IND,
    APPLICATION_SUBMIT_DT,
    BENEFICIARIES_RECORDED_IND,
    CONVERSION_EXPIRED_IND,
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    DEFAULT_VOLUNTARY_DEFERRAL_RT,
    ENROLLMENT_DT,
    ENROLLMENT_ELIGIBILITY_DT,
    ENROLLMENT_START_DT,
    ENROLLMENT_END_DT,
    ENROLLMENT_STATUS_CDE,
    ENROLLMENT_TYPE_CDE,
    FACE_AMT,
    INTERNAL_PLAN_ID,
    ISSUE_DT,
    PARTICIPATION_DT,
    SOLICITATION_DT,
    SOLICITATION_IND,
    TAFT_HARTLY_IND,
    ELECTRONIC_CONTRIBUTION_CHANGE_IND,
    PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
    BEGIN_DT,
    BEGIN_DTM,
    ROW_PROCESS_DTM,
    AUDIT_ID,
    LOGICAL_DELETE_IND,
    CHECK_SUM,
    CURRENT_ROW_IND,
    END_DT,
    END_DTM,
    SOURCE_SYSTEM_ID,
    RESTRICTED_ROW_IND,
    --ROW_SID,
    NEXT_PAYMENT_DT,
    NEXT_PAYMENT_AMT,
    CURRENT_PRINCIPAL_AMT,
    LOAN_BOOKED_COUPON_RT,
    LOAN_BOOKED_AMT,
    LOAN_REQUESTED_COUPON_RT,
    LOAN_REQUESTED_AMT,
    LOAN_MONTHS_TO_MATURITY_VAL,
    LOAN_DEGREE_PROGRAM_DESC,
    DECISIONING_ANNUAL_INCOME_AMT,
    APPLICATION_STATUS_DT,
    LOAN_REPORT_UNIQUE_HASH_ID,
    ESERVICE_IND,
    AGREEMENT_EFFECTIVE_DT,
    UPDATE_AUDIT_ID,
    TERMINATED_PARTICIPANT_SERVICING_IND,
    MANAGED_ACCOUNTS_ELIGIBILITY_IND,
    MANAGED_ACCOUNTS_PARTICIPATION_IND,
	MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
    SOURCE_AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_CATEGORY_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_PLAN_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    SOURCE_READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_AGREEMENT_NR,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    ISSUE_STATE_CDE,
    LAPSE_DT,
    CONVERSION_STATUS_CDE,
    LAST_ANNIVERSARY_DT,
    NEXT_ANNIVERSARY_DT,
    INSURED_ISSUE_AGE_NR,
    SMOKER_CDE,
    MEC_CDE,
    SOURCE_MEC_CDE,
    PLAN_YEAR_NR,
    PLAN_MONTH_NR,
    AGREEMENT_CUSIP_CDE,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    APL_CDE,
    BASE_FACE_RATING_NR,
    BASE_TEMPORARY_PREMIUM_AMT,
    BASE_TEMPORARY_DURATION_NR,
    BASE_PERMANENT_PREMIUM_AMT,
    BASE_FACE_AMT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    exchange_provision_cde,
    SOURCE_exchange_provision_cde,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    SOURCE_DELETE_IND,
    SOURCE_PRODUCT_TYPE_CDE,
	PERSISTENCY_CREDIT_CDE,
	SOURCE_PERSISTENCY_CREDIT_CDE,
	PERSISTENCY_CREDIT_START_DT,
	DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
)
SELECT
    UUID_GEN(
            SRC.AGREEMENT_SOURCE_CDE,
            SRC.AGREEMENT_TYPE_CDE,
            SRC.AGREEMENT_NR_PFX,
            SRC.AGREEMENT_NR,
            SRC.AGREEMENT_NR_SFX
        )::UUID AS DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
        AGREEMENT_NR_PFX,
        AGREEMENT_NR,
        AGREEMENT_NR_SFX,
        AGREEMENT_SOURCE_CDE,
        AGREEMENT_TYPE_CDE,
        MASTER_CONTRACT_GROUP_ID,
        SPONSOR_ID,
        PLAN_ID,
        SUBSCRIBER_ID,
        PARTICIPANT_ID,
        ICU_ID,
        MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC,
        PLAN_NM_1_TXT,
        PLAN_NM_2_TXT,
        PLAN_NM_3_TXT,
        SUBSCRIBER_NR,
        AGREEMENT_STATUS_CDE,
        AGREEMENT_STATUS_REASON_CDE,
        ALLOW_ROLLOVER_IND,
        APPLICATION_SUBMIT_DT,
        BENEFICIARIES_RECORDED_IND,
		NULL AS CONVERSION_EXPIRED_IND,
        CONVERSION_ELIGIBILITY_START_DT,
        CONVERSION_ELIGIBILITY_END_DT,
        DEFAULT_VOLUNTARY_DEFERRAL_RT,
        ENROLLMENT_DT,
        ENROLLMENT_ELIGIBILITY_DT,
        ENROLLMENT_START_DT,
        ENROLLMENT_END_DT,
        ENROLLMENT_STATUS_CDE,
        ENROLLMENT_TYPE_CDE,
        FACE_AMT,
        INTERNAL_PLAN_ID,
        ISSUE_DT,
        PARTICIPATION_DT,
        SOLICITATION_DT,
        SOLICITATION_IND,
        TAFT_HARTLY_IND,
        ELECTRONIC_CONTRIBUTION_CHANGE_IND,
        PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
        BEGIN_DT,
        BEGIN_DTM,
        ROW_PROCESS_DTM,
        AUDIT_ID,
        LOGICAL_DELETE_IND,
        UUID_GEN(
                SOURCE_DELETE_IND,
                CLEAN_STRING(MASTER_CONTRACT_GROUP_ID),
                CLEAN_STRING(SPONSOR_ID),
                CLEAN_STRING(PLAN_ID),
                CLEAN_STRING(SUBSCRIBER_ID),
                CLEAN_STRING(PARTICIPANT_ID),
                CLEAN_STRING(ICU_ID),
                CLEAN_STRING(MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC),
                CLEAN_STRING(PLAN_NM_1_TXT),
                CLEAN_STRING(PLAN_NM_2_TXT),
                CLEAN_STRING(PLAN_NM_3_TXT),
                SUBSCRIBER_NR,
                AGREEMENT_STATUS_CDE,
                AGREEMENT_STATUS_REASON_CDE,
                ALLOW_ROLLOVER_IND,
                APPLICATION_SUBMIT_DT,
                BENEFICIARIES_RECORDED_IND,
				NULL,
                CONVERSION_ELIGIBILITY_START_DT,
                CONVERSION_ELIGIBILITY_END_DT,
                DEFAULT_VOLUNTARY_DEFERRAL_RT,
                ENROLLMENT_DT,
                ENROLLMENT_ELIGIBILITY_DT,
                ENROLLMENT_START_DT,
                ENROLLMENT_END_DT,
                CLEAN_STRING(ENROLLMENT_STATUS_CDE),
                CLEAN_STRING(ENROLLMENT_TYPE_CDE),
                FACE_AMT,
                CLEAN_STRING(INTERNAL_PLAN_ID),
                ISSUE_DT,
                PARTICIPATION_DT,
                SOLICITATION_DT,
                SOLICITATION_IND,
                TAFT_HARTLY_IND,
                ELECTRONIC_CONTRIBUTION_CHANGE_IND,
                PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
                NEXT_PAYMENT_DT,
                NEXT_PAYMENT_AMT,
                CURRENT_PRINCIPAL_AMT,
                LOAN_BOOKED_COUPON_RT,
                LOAN_BOOKED_AMT,
                LOAN_REQUESTED_COUPON_RT,
                LOAN_REQUESTED_AMT,
                LOAN_MONTHS_TO_MATURITY_VAL,
                CLEAN_STRING(LOAN_DEGREE_PROGRAM_DESC),
                DECISIONING_ANNUAL_INCOME_AMT,
                APPLICATION_STATUS_DT,
                CLEAN_STRING(LOAN_REPORT_UNIQUE_HASH_ID),
                ESERVICE_IND,
                AGREEMENT_EFFECTIVE_DT,
                TERMINATED_PARTICIPANT_SERVICING_IND,
                MANAGED_ACCOUNTS_ELIGIBILITY_IND,
                MANAGED_ACCOUNTS_PARTICIPATION_IND,
				MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
                CLEAN_STRING(SOURCE_AGREEMENT_STATUS_CDE),
                CLEAN_STRING(SOURCE_AGREEMENT_STATUS_REASON_CDE),
                CLEAN_STRING(SOURCE_AGREEMENT_STATUS_CATEGORY_CDE),
                AGREEMENT_STATUS_DT,
                DIM_PRODUCT_NATURAL_KEY_HASH_UUID::VARCHAR,
                PT1_KIND_CDE,
                PT2_ISSUE_BASIS_CDE,
                PT3_RATE_CDE,
                MATURITY_DT,
                ANNIVERSARY_DT,
                TERMINATION_DT,
                APPLICATION_RECEIVED_DT,
                APPLICATION_SIGNED_DT,
                MARKET_CATEGORY_TYPE_CDE,
                CLEAN_STRING(SOURCE_PLAN_TYPE_CDE),
                CLEAN_STRING(SOURCE_MARKET_CATEGORY_TYPE_CDE),
                TAX_QUALIFIED_CDE,
                CLEAN_STRING(SOURCE_TAX_QUALIFIED_CDE),
                REPLACEMENT_TYPE_CDE,
                CLEAN_STRING(SOURCE_REPLACEMENT_TYPE_CDE),
                RESTRICTION_CDE,
                CLEAN_STRING(SOURCE_RESTRICTION_CDE),
                RESTRICTION_CATEGORY_CDE,
                CLEAN_STRING(SOURCE_RESTRICTION_CATEGORY_CDE),
                COMPANY_CDE,
                CLEAN_STRING(SOURCE_COMPANY_CDE),
                FROZEN_CDE,
                CLEAN_STRING(SOURCE_FROZEN_CDE),
                HOME_OFFICE_AMOUNT_SUSPEND_CDE,
                CLEAN_STRING(SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE),
                LOST_INSURED_IND,
                SOURCE_LOST_INSURED_IND,
                CLEAN_STRING(TITLE_MESSAGE_TXT),
                CLEAN_STRING(OFFER_ACCEPTANCE_CDE),
                CLEAN_STRING(SOURCE_OFFER_ACCEPTANCE_CDE),
                CLEAN_STRING(VARIABLE_PRODUCT_CDE),
                CONTRACT_JURISDICTION_STATE_CDE,
                CLEAN_STRING(TAX_ACCOUNT_NR),
                CLEAN_STRING(READABILITY_CDE),
                CLEAN_STRING(SOURCE_READABILITY_CDE),
                CLEAN_STRING(VANTAGE_RESTRICTION_CDE),
                CLEAN_STRING(SUSPEND_CDE),
                CLEAN_STRING(SOURCE_SUSPEND_CDE),
                CLEAN_STRING(SOURCE_PRODUCT_SHORT_NM),
                CLEAN_STRING(SOURCE_PRODUCT_LONG_NM),
                CLEAN_STRING(SPECIAL_HANDLING_CDE),
                CLEAN_STRING(SOURCE_SPECIAL_HANDLING_CDE),
                CLEAN_STRING(ISSUE_REASON_CDE),
                CLEAN_STRING(SOURCE_ISSUE_REASON_CDE),
                CDSC_PERIOD_YEAR_NR,
                RENEWAL_DT,
                RETIRE_GUARD_IND,
                CLEAN_STRING(SOURCE_ADMIN_ERROR_CDE),
                CLEAN_STRING(SOURCE_PENDING_ACTIVITY_CDE),
                CLEAN_STRING(SOURCE_AGREEMENT_NR),
                WORKSITE_IND,
                PRODUCT_GROUP_CDE,
                CLEAN_STRING(UPDATE_STATE_CDE),
                AGENCY_SUSPEND_ITEM_CDE,
                CLEAN_STRING(DISTRIBUTOR_CLIENT_ACCOUNT_ID),
                CLEAN_STRING(RESIDENT_STATE_CDE),
                CLEAN_STRING(SOLICITATION_STATE_CDE),
                CLEAN_STRING(DISTRIBUTION_CHANNEL_CDE),
                CLEAN_STRING(SOURCE_DISTRIBUTION_CHANNEL_CDE),
                CLEAN_STRING(PRODUCT_TIER_CDE),
                CLEAN_STRING(REPLACEMENT_CDE),
                CLEAN_STRING(SOURCE_REPLACEMENT_CDE),
                CLEAN_STRING(SPECIAL_CONDITION_CDE),
                CLEAN_STRING(SPECIAL_CONDITION_REASON_CDE),
                CLEAN_STRING(SPECIAL_CONDITION_CATEGORY_CDE),
                CLEAN_STRING(SPECIAL_CONDITION_2_CDE),
                CLEAN_STRING(SPECIAL_CONDITION_2_REASON_CDE),
                CLEAN_STRING(SPECIAL_CONDITION_2_CATEGORY_CDE),
                SPM_GROUP_BILLED_SUSPENSE_IND,
                SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
                SPM_GROUP_AR_SUSPENSE_IND,
                ACTIVELY_AT_WORK_IND,
                CLEAN_STRING(MARKET_GROUP_CDE),
                PT_TRANS_TO_INSD_DT,
                MANAGERIAL_IND,
                INIT_PD_TO_DT,
                CLEAN_STRING(INSURED_INTERESTED_PARTY_NR_TXT),
                CLEAN_STRING(ISSUE_STATE_CDE),
                LAPSE_DT,
                CLEAN_STRING(CONVERSION_STATUS_CDE),
                LAST_ANNIVERSARY_DT,
                NEXT_ANNIVERSARY_DT,
                INSURED_ISSUE_AGE_NR,
                CLEAN_STRING(SMOKER_CDE),
                MEC_CDE,
                CLEAN_STRING(SOURCE_MEC_CDE),
                PLAN_YEAR_NR,
                PLAN_MONTH_NR,
                CLEAN_STRING(AGREEMENT_CUSIP_CDE),
                AGREEMENT_DIVIDEND_OPTION_CDE,
                CLEAN_STRING(SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE),
                APL_CDE,
                BASE_FACE_RATING_NR,
                BASE_TEMPORARY_PREMIUM_AMT,
                BASE_TEMPORARY_DURATION_NR,
                BASE_PERMANENT_PREMIUM_AMT,
                BASE_FACE_AMT,
                CLEAN_STRING(ACTIVITY_PENDING_CDE),
                CLEAN_STRING(ACTIVITY_PENDING_DESC),
                CLEAN_STRING(SOURCE_ACTIVITY_PENDING_DESC),
                APD_IND,
                CLEAN_STRING(SOURCE_APD_IND),
                APM_NR_TXT,
                CLEAN_STRING(SOURCE_APM_NR_TXT),
                CLEAN_STRING(SOURCE_APL_CDE),
                CONVERSION_IND,
                CLEAN_STRING(SOURCE_CONVERSION_IND),
                CONVERTED_POLICY_TYPE_CDE,
                CLEAN_STRING(SOURCE_CONVERTED_POLICY_TYPE_CDE),
                CLEAN_STRING(CONVERTED_POLICY_NR_TXT),
                ACTIVITY_CDE,
                CLEAN_STRING(DELIVERY_DATA_CDE),
                CLEAN_STRING(SOURCE_DELIVERY_DATA_CDE),
                BENEFIT_AMT,
                DEATH_BENEFIT_OPTION_CDE,
                DEATH_BENEFIT_OPTION_INTEREST_RT,
                DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
                CLEAN_STRING(exchange_provision_cde),
                CLEAN_STRING(SOURCE_exchange_provision_cde),
                FREE_LOOK_EXPIRY_DT,
                CLEAN_STRING(INSURANCE_ANNUITY_CDE),
                CLEAN_STRING(SOURCE_INSURANCE_ANNUITY_CDE),
                LUMP_SUM_BENEFIT_AMT,
                MEC_EFFECTIVE_DT,
                MEC_STATUS_CDE,
                CLEAN_STRING(SOURCE_MEC_STATUS_CDE),
                NON_FORFEITURE_OPTION_CDE,
                CLEAN_STRING(ADMSPEC_CDE),
                CLEAN_STRING(SOURCE_ADMSPEC_CDE),
                PURPOSE_OF_INSURANCE_CATEGORY_CDE,
                PURPOSE_OF_INSURANCE_CDE,
                PEND_SETTLE_CDE,
                REINSURED_CDE,
                CLEAN_STRING(SOURCE_REINSURED_CDE),
                TEMPORARY_TERM_PRE_EFFECTIVE_DT,
                TEMPORARY_TERM_STATUS_CDE,
                YEARLY_TERM_PURCHASE_CDE,
                POLICY_LAPSE_DT,
                CLEAN_STRING(DBO_SHORT_NM),
                MEC_EFFECTIVE_DT_QUALITY_CDE,
                VLR_RC,
                CLEAN_STRING(TELEPHONE_AUTHORIZATION_CDE),
                CLEAN_STRING(TAX_AGG_CDE),
                CLEAN_STRING(SOURCE_TAX_AGG_CDE),
                TAX_AMT_NOT_DETERMINED_IND,
                ASSIGN_DT,
                EARLIEST_PERMITTED_ANNUITY_DT,
                LATEST_PERMITTED_ANNUITY_DT,
                CLEAN_STRING(SOURCE_TELEPHONE_AUTHORIZATION_CDE),
                CLEAN_STRING(WITHDRAWAL_OPTION_CDE),
                CLEAN_STRING(SOURCE_WITHDRAWAL_OPTION_CDE),
                CLEAN_STRING(GLWB_STATUS_CDE),
                CLEAN_STRING(SOURCE_GLWB_STATUS_CDE),
                GLWB_STATUS_DT,
                CLEAN_STRING(REINSURANCE_TREATY_NR_TXT),
                CLEAN_STRING(EXCESS_WITHDRAWAL_CDE),
                CLEAN_STRING(SOURCE_EXCESS_WITHDRAWAL_CDE),
                VI_RIDER_IND,
                PORTABILITY_IND,
                AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
                CLEAN_STRING(SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE),
                CLEAN_STRING(AGREEMENT_DIVIDEND_OPTION_DESC),
                CLEAN_STRING(AGREEMENT_SECOND_DIVIDEND_OPTION_DESC),
                CLEAN_STRING(SOURCE_PRODUCT_TYPE_CDE),
				PERSISTENCY_CREDIT_CDE,
				SOURCE_PERSISTENCY_CREDIT_CDE,
				PERSISTENCY_CREDIT_START_DT,
				DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
                 )::UUID
        AS CHECK_SUM,
        CURRENT_ROW_IND,
        END_DT,
        END_DTM,
        SOURCE_SYSTEM_ID,
        RESTRICTED_ROW_IND,
        NEXT_PAYMENT_DT,
        NEXT_PAYMENT_AMT,
        CURRENT_PRINCIPAL_AMT,
        LOAN_BOOKED_COUPON_RT,
        LOAN_BOOKED_AMT,
        LOAN_REQUESTED_COUPON_RT,
        LOAN_REQUESTED_AMT,
        LOAN_MONTHS_TO_MATURITY_VAL,
        LOAN_DEGREE_PROGRAM_DESC,
        DECISIONING_ANNUAL_INCOME_AMT,
        APPLICATION_STATUS_DT,
        LOAN_REPORT_UNIQUE_HASH_ID,
        ESERVICE_IND,
        AGREEMENT_EFFECTIVE_DT,
        UPDATE_AUDIT_ID,
        TERMINATED_PARTICIPANT_SERVICING_IND,
        MANAGED_ACCOUNTS_ELIGIBILITY_IND,
        MANAGED_ACCOUNTS_PARTICIPATION_IND,
		MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
        SOURCE_AGREEMENT_STATUS_CDE,
        SOURCE_AGREEMENT_STATUS_REASON_CDE,
        SOURCE_AGREEMENT_STATUS_CATEGORY_CDE,
        AGREEMENT_STATUS_DT,
        DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
        PT1_KIND_CDE,
        PT2_ISSUE_BASIS_CDE,
        PT3_RATE_CDE,
        MATURITY_DT,
        ANNIVERSARY_DT,
        TERMINATION_DT,
        APPLICATION_RECEIVED_DT,
        APPLICATION_SIGNED_DT,
        MARKET_CATEGORY_TYPE_CDE,
        SOURCE_PLAN_TYPE_CDE,
        SOURCE_MARKET_CATEGORY_TYPE_CDE,
        TAX_QUALIFIED_CDE,
        SOURCE_TAX_QUALIFIED_CDE,
        REPLACEMENT_TYPE_CDE,
        SOURCE_REPLACEMENT_TYPE_CDE,
        RESTRICTION_CDE,
        SOURCE_RESTRICTION_CDE,
        RESTRICTION_CATEGORY_CDE,
        SOURCE_RESTRICTION_CATEGORY_CDE,
        COMPANY_CDE,
        SOURCE_COMPANY_CDE,
        FROZEN_CDE,
        SOURCE_FROZEN_CDE,
        HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        LOST_INSURED_IND,
        SOURCE_LOST_INSURED_IND,
        TITLE_MESSAGE_TXT,
        OFFER_ACCEPTANCE_CDE,
        SOURCE_OFFER_ACCEPTANCE_CDE,
        VARIABLE_PRODUCT_CDE,
        CONTRACT_JURISDICTION_STATE_CDE,
        TAX_ACCOUNT_NR,
        READABILITY_CDE,
        SOURCE_READABILITY_CDE,
        VANTAGE_RESTRICTION_CDE,
        SUSPEND_CDE,
        SOURCE_SUSPEND_CDE,
        SOURCE_PRODUCT_SHORT_NM,
        SOURCE_PRODUCT_LONG_NM,
        SPECIAL_HANDLING_CDE,
        SOURCE_SPECIAL_HANDLING_CDE,
        ISSUE_REASON_CDE,
        SOURCE_ISSUE_REASON_CDE,
        CDSC_PERIOD_YEAR_NR,
        RENEWAL_DT,
        RETIRE_GUARD_IND,
        SOURCE_ADMIN_ERROR_CDE,
        SOURCE_PENDING_ACTIVITY_CDE,
        SOURCE_AGREEMENT_NR,
        WORKSITE_IND,
        PRODUCT_GROUP_CDE,
        UPDATE_STATE_CDE,
        AGENCY_SUSPEND_ITEM_CDE,
        DISTRIBUTOR_CLIENT_ACCOUNT_ID,
        RESIDENT_STATE_CDE,
        SOLICITATION_STATE_CDE,
        DISTRIBUTION_CHANNEL_CDE,
        SOURCE_DISTRIBUTION_CHANNEL_CDE,
        PRODUCT_TIER_CDE,
        REPLACEMENT_CDE,
        SOURCE_REPLACEMENT_CDE,
        SPECIAL_CONDITION_CDE,
        SPECIAL_CONDITION_REASON_CDE,
        SPECIAL_CONDITION_CATEGORY_CDE,
        SPECIAL_CONDITION_2_CDE,
        SPECIAL_CONDITION_2_REASON_CDE,
        SPECIAL_CONDITION_2_CATEGORY_CDE,
        SPM_GROUP_BILLED_SUSPENSE_IND,
        SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
        SPM_GROUP_AR_SUSPENSE_IND,
        ACTIVELY_AT_WORK_IND,
        MARKET_GROUP_CDE,
        PT_TRANS_TO_INSD_DT,
        MANAGERIAL_IND,
        INIT_PD_TO_DT,
        INSURED_INTERESTED_PARTY_NR_TXT,
        ISSUE_STATE_CDE,
        LAPSE_DT,
        CONVERSION_STATUS_CDE,
        LAST_ANNIVERSARY_DT,
        NEXT_ANNIVERSARY_DT,
        INSURED_ISSUE_AGE_NR,
        SMOKER_CDE,
        MEC_CDE,
        SOURCE_MEC_CDE,
        PLAN_YEAR_NR,
        PLAN_MONTH_NR,
        AGREEMENT_CUSIP_CDE,
        AGREEMENT_DIVIDEND_OPTION_CDE,
        SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
        APL_CDE,
        BASE_FACE_RATING_NR,
        BASE_TEMPORARY_PREMIUM_AMT,
        BASE_TEMPORARY_DURATION_NR,
        BASE_PERMANENT_PREMIUM_AMT,
        BASE_FACE_AMT,
        ACTIVITY_PENDING_CDE,
        ACTIVITY_PENDING_DESC,
        SOURCE_ACTIVITY_PENDING_DESC,
        APD_IND,
        SOURCE_APD_IND,
        APM_NR_TXT,
        SOURCE_APM_NR_TXT,
        SOURCE_APL_CDE,
        CONVERSION_IND,
        SOURCE_CONVERSION_IND,
        CONVERTED_POLICY_TYPE_CDE,
        SOURCE_CONVERTED_POLICY_TYPE_CDE,
        CONVERTED_POLICY_NR_TXT,
        ACTIVITY_CDE,
        DELIVERY_DATA_CDE,
        SOURCE_DELIVERY_DATA_CDE,
        BENEFIT_AMT,
        DEATH_BENEFIT_OPTION_CDE,
        DEATH_BENEFIT_OPTION_INTEREST_RT,
        DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
        exchange_provision_cde,
        SOURCE_exchange_provision_cde,
        FREE_LOOK_EXPIRY_DT,
        INSURANCE_ANNUITY_CDE,
        SOURCE_INSURANCE_ANNUITY_CDE,
        LUMP_SUM_BENEFIT_AMT,
        MEC_EFFECTIVE_DT,
        MEC_STATUS_CDE,
        SOURCE_MEC_STATUS_CDE,
        NON_FORFEITURE_OPTION_CDE,
        ADMSPEC_CDE,
        SOURCE_ADMSPEC_CDE,
        PURPOSE_OF_INSURANCE_CATEGORY_CDE,
        PURPOSE_OF_INSURANCE_CDE,
        PEND_SETTLE_CDE,
        REINSURED_CDE,
        SOURCE_REINSURED_CDE,
        TEMPORARY_TERM_PRE_EFFECTIVE_DT,
        TEMPORARY_TERM_STATUS_CDE,
        YEARLY_TERM_PURCHASE_CDE,
        POLICY_LAPSE_DT,
        DBO_SHORT_NM,
        MEC_EFFECTIVE_DT_QUALITY_CDE,
        VLR_RC,
        TELEPHONE_AUTHORIZATION_CDE,
        TAX_AGG_CDE,
        SOURCE_TAX_AGG_CDE,
        TAX_AMT_NOT_DETERMINED_IND,
        ASSIGN_DT,
        EARLIEST_PERMITTED_ANNUITY_DT,
        LATEST_PERMITTED_ANNUITY_DT,
        SOURCE_TELEPHONE_AUTHORIZATION_CDE,
        WITHDRAWAL_OPTION_CDE,
        SOURCE_WITHDRAWAL_OPTION_CDE,
        GLWB_STATUS_CDE,
        SOURCE_GLWB_STATUS_CDE,
        GLWB_STATUS_DT,
        REINSURANCE_TREATY_NR_TXT,
        EXCESS_WITHDRAWAL_CDE,
        SOURCE_EXCESS_WITHDRAWAL_CDE,
        VI_RIDER_IND,
        PORTABILITY_IND,
        AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        AGREEMENT_DIVIDEND_OPTION_DESC,
        AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
        SOURCE_DELETE_IND,
        SOURCE_PRODUCT_TYPE_CDE,
		PERSISTENCY_CREDIT_CDE,
		SOURCE_PERSISTENCY_CREDIT_CDE,
		PERSISTENCY_CREDIT_START_DT,
		DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
FROM
(
    SELECT
        CLEAN_STRING(PUBLIC.UDF_AIF_HLDG_KEY_FORMAT(CONTRACT.AIFCOW_POLICY_ID,'PFX')) AS AGREEMENT_NR_PFX,
        PUBLIC.UDF_AIF_HLDG_KEY_FORMAT(CONTRACT.AIFCOW_POLICY_ID,'KEY') AS AGREEMENT_NR,
        CLEAN_STRING(PUBLIC.UDF_AIF_HLDG_KEY_FORMAT(CONTRACT.AIFCOW_POLICY_ID,'SFX')) AS AGREEMENT_NR_SFX,
        CLEAN_STRING(AGREEMENT_SDT.TRNSLT_FLD_VAL) AS AGREEMENT_SOURCE_CDE,
        CLEAN_STRING('IPA') AS AGREEMENT_TYPE_CDE,
        NULL As MASTER_CONTRACT_GROUP_ID,
        NULL As SPONSOR_ID,
        NULL As PLAN_ID,
        NULL As SUBSCRIBER_ID,
        NULL As PARTICIPANT_ID,
        NULL As ICU_ID,
        NULL As MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC,
        NULL As PLAN_NM_1_TXT,
        NULL As PLAN_NM_2_TXT,
        NULL As PLAN_NM_3_TXT,
        NULL As SUBSCRIBER_NR,
        COALESCE(CLEAN_STRING(AGREEMENT_STATUS_CDE_SDT.TRNSLT_FLD_VAL), 'Unk') AS AGREEMENT_STATUS_CDE,
        COALESCE(CLEAN_STRING(AGREEMENT_STATUS_RSN_CDE_SDT.TRNSLT_FLD_VAL), 'Unk') AS AGREEMENT_STATUS_REASON_CDE,
        NULL As ALLOW_ROLLOVER_IND,
        NULL As APPLICATION_SUBMIT_DT,
        NULL As BENEFICIARIES_RECORDED_IND,
		NULL AS CONVERSION_ELIGIBILITY_START_DT,
        NULL AS CONVERSION_ELIGIBILITY_END_DT,
        NULL As DEFAULT_VOLUNTARY_DEFERRAL_RT,
        NULL As ENROLLMENT_DT,
        NULL As ENROLLMENT_ELIGIBILITY_DT,
        NULL As ENROLLMENT_START_DT,
        NULL As ENROLLMENT_END_DT,
        NULL As ENROLLMENT_STATUS_CDE,
        NULL As ENROLLMENT_TYPE_CDE,
        NULL AS FACE_AMT,
        NULL As INTERNAL_PLAN_ID,
		CASE WHEN TO_CHAR(CONTRACT.AIFCOW_POLICY_ISSUE_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_ISSUE_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_ISSUE_DD),2,'0')
		=99999999 OR TO_CHAR(CONTRACT.AIFCOW_POLICY_ISSUE_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_ISSUE_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_ISSUE_DD),2,'0')
		>52000000 THEN TO_DATE('9999-12-31','YYYY-MM-DD') 
		ELSE PUBLIC.ISDATE((TO_CHAR(CONTRACT.AIFCOW_POLICY_ISSUE_YYYY))
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_ISSUE_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_ISSUE_DD),2,'0')) 
		END AS ISSUE_DT,
        NULL As PARTICIPATION_DT,
        NULL As SOLICITATION_DT,
        NULL As SOLICITATION_IND,
        NULL As TAFT_HARTLY_IND,
        NULL As ELECTRONIC_CONTRIBUTION_CHANGE_IND,
        NULL As PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
        CONTRACT.BEGIN_DT AS BEGIN_DT,
        CONTRACT.BEGIN_DT AS BEGIN_DTM,
        CURRENT_TIMESTAMP(6) AS ROW_PROCESS_DTM,
        :audit_id AS AUDIT_ID,
        FALSE AS LOGICAL_DELETE_IND,
        TRUE AS CURRENT_ROW_IND,
        '9999-12-31'::DATE AS END_DT,
        '9999-12-31'::TIMESTAMP AS END_DTM,
        '72' AS SOURCE_SYSTEM_ID,
        FALSE AS RESTRICTED_ROW_IND,
        NULL As NEXT_PAYMENT_DT,
        NULL As NEXT_PAYMENT_AMT,
        NULL As CURRENT_PRINCIPAL_AMT,
        NULL As LOAN_BOOKED_COUPON_RT,
        NULL As LOAN_BOOKED_AMT,
        NULL As LOAN_REQUESTED_COUPON_RT,
        NULL As LOAN_REQUESTED_AMT,
        NULL As LOAN_MONTHS_TO_MATURITY_VAL,
        NULL As LOAN_DEGREE_PROGRAM_DESC,
        NULL As DECISIONING_ANNUAL_INCOME_AMT,
        NULL As APPLICATION_STATUS_DT,
        NULL As LOAN_REPORT_UNIQUE_HASH_ID,
        NULL As ESERVICE_IND,
		CASE WHEN TO_CHAR(CONTRACT.AIFCOW_POLICY_EFF_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_EFF_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_EFF_DD),2,'0')
		=99999999 OR TO_CHAR(CONTRACT.AIFCOW_POLICY_EFF_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_EFF_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_EFF_DD),2,'0')
		>52000000 THEN TO_DATE('9999-12-31','YYYY-MM-DD') 
		ELSE PUBLIC.ISDATE((TO_CHAR(CONTRACT.AIFCOW_POLICY_EFF_YYYY))
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_EFF_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_POLICY_EFF_DD),2,'0')) 
		END AS AGREEMENT_EFFECTIVE_DT,
        :audit_id AS UPDATE_AUDIT_ID,
        NULL As TERMINATED_PARTICIPANT_SERVICING_IND,
        NULL As MANAGED_ACCOUNTS_ELIGIBILITY_IND,
        NULL As MANAGED_ACCOUNTS_PARTICIPATION_IND,
        NULL As MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
        CONTRACT.AIFCOW_CONTRACT_STATUS_CODE AS SOURCE_AGREEMENT_STATUS_CDE,
        CONTRACT.AIFCOW_CONTRACT_STATUS_CODE AS SOURCE_AGREEMENT_STATUS_REASON_CDE,
        NULL As SOURCE_AGREEMENT_STATUS_CATEGORY_CDE,
		CASE WHEN TO_CHAR(CONTRACT.AIFCOW_LAST_STATUS_CHG_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_LAST_STATUS_CHG_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_LAST_STATUS_CHG_DD),2,'0')
		=99999999 OR TO_CHAR(CONTRACT.AIFCOW_LAST_STATUS_CHG_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_LAST_STATUS_CHG_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_LAST_STATUS_CHG_DD),2,'0')
		>52000000 THEN TO_DATE('9999-12-31','YYYY-MM-DD') 
		ELSE PUBLIC.ISDATE((TO_CHAR(CONTRACT.AIFCOW_LAST_STATUS_CHG_YYYY))
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_LAST_STATUS_CHG_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_LAST_STATUS_CHG_DD),2,'0')) 
		END AS AGREEMENT_STATUS_DT,
        CASE WHEN PRODUCT_DT.PROD_ID IS NULL THEN UUID_GEN(CLEAN_STRING('UNK'))::UUID ELSE UUID_GEN(CLEAN_STRING(PRODUCT_DT.PROD_ID))::UUID END AS DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
        CLEAN_STRING(LTRIM(RTRIM(CONTRACT.AIFCOW_PLAN_CODE))) AS PT1_KIND_CDE,
        '00' AS PT2_ISSUE_BASIS_CDE,
		'0000' AS PT3_RATE_CDE,
        CASE WHEN TO_CHAR(CONTRACT.AIFCOW_MATURITY_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_MATURITY_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_MATURITY_DD),2,'0')
		=99999999 OR TO_CHAR(CONTRACT.AIFCOW_MATURITY_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_MATURITY_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_MATURITY_DD),2,'0')
		>52000000 THEN TO_DATE('9999-12-31','YYYY-MM-DD') 
		ELSE PUBLIC.ISDATE((TO_CHAR(CONTRACT.AIFCOW_MATURITY_YYYY))
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_MATURITY_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_MATURITY_DD),2,'0')) 
		END AS MATURITY_DT,
        NULL AS ANNIVERSARY_DT,
        CASE WHEN TO_CHAR(CONTRACT.AIFCOW_EXPIRATION_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_EXPIRATION_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_EXPIRATION_DD),2,'0')
		=99999999 OR TO_CHAR(CONTRACT.AIFCOW_EXPIRATION_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_EXPIRATION_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_EXPIRATION_DD),2,'0')
		>52000000 THEN TO_DATE('9999-12-31','YYYY-MM-DD') 
		ELSE PUBLIC.ISDATE((TO_CHAR(CONTRACT.AIFCOW_EXPIRATION_YYYY))
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_EXPIRATION_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_EXPIRATION_DD),2,'0')) 
		END AS TERMINATION_DT,
        CASE WHEN TO_CHAR(CONTRACT.AIFCOW_APP_RECEIVED_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_APP_RECEIVED_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_APP_RECEIVED_DD),2,'0')
		=99999999 OR TO_CHAR(CONTRACT.AIFCOW_APP_RECEIVED_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_APP_RECEIVED_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_APP_RECEIVED_DD),2,'0')
		>52000000 THEN TO_DATE('9999-12-31','YYYY-MM-DD') 
		ELSE PUBLIC.ISDATE((TO_CHAR(CONTRACT.AIFCOW_APP_RECEIVED_YYYY))
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_APP_RECEIVED_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_APP_RECEIVED_DD),2,'0')) 
		END As APPLICATION_RECEIVED_DT,
        CASE WHEN LTRIM(RTRIM(CONTRACT.AIFCOW_APP_DATE))='99999999' OR TO_CHAR(LTRIM(RTRIM(CONTRACT.AIFCOW_APP_DATE))) > 52000000
		THEN  TO_DATE('9999-12-31','YYYY-MM-DD')  ELSE PUBLIC.ISDATE(CONTRACT.AIFCOW_APP_DATE) END  As APPLICATION_SIGNED_DT,
        COALESCE(CLEAN_STRING(MARKET_SDT.TRNSLT_FLD_VAL),'Unk') AS MARKET_CATEGORY_TYPE_CDE,
        NULL AS SOURCE_PLAN_TYPE_CDE,
        CONTRACT.AIFCOW_LOB_CODE AS SOURCE_MARKET_CATEGORY_TYPE_CDE,
        COALESCE(CLEAN_STRING(TAX_QUALIFIED_CDE_SDT.TRNSLT_FLD_VAL),'Unk') AS TAX_QUALIFIED_CDE,
        CONTRACT.AIFCOW_LOB_CODE AS SOURCE_TAX_QUALIFIED_CDE,
        COALESCE(CLEAN_STRING(REPLACEMENT_TYPE_CDE_SDT.TRNSLT_FLD_VAL), 'Unk') AS REPLACEMENT_TYPE_CDE,
        CONTRACT.AIFCOW_RPS_REPLACEMENT_TYPE AS SOURCE_REPLACEMENT_TYPE_CDE,
        COALESCE(CLEAN_STRING(RESTRICT_CD_SDT.TRNSLT_FLD_VAL), 'Unk') AS RESTRICTION_CDE,
        CONTRACT.AIFCOW_RESTRICTION_CODE AS SOURCE_RESTRICTION_CDE,
        NULL AS RESTRICTION_CATEGORY_CDE,
        NULL AS SOURCE_RESTRICTION_CATEGORY_CDE,
        COALESCE(CLEAN_STRING(COMPANY_CDE_SDT.TRNSLT_FLD_VAL),'Unk') AS COMPANY_CDE,
        CONTRACT.AIFCOW_COMPANY_CODE AS SOURCE_COMPANY_CDE,
        NULL AS FROZEN_CDE,
        NULL AS SOURCE_FROZEN_CDE,
        COALESCE(CLEAN_STRING(HOME_OFFICE_AMOUNT_SUSPEND_SDT.TRNSLT_FLD_VAL), 'Unk') AS HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        CONTRACT.AIFCOW_SUSPENSE_CODE AS SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        NULL As LOST_INSURED_IND,
        NULL As SOURCE_LOST_INSURED_IND,
        NULL As TITLE_MESSAGE_TXT,
        NULL As OFFER_ACCEPTANCE_CDE,
        NULL As SOURCE_OFFER_ACCEPTANCE_CDE,
        NULL AS VARIABLE_PRODUCT_CDE,
        CLEAN_STRING(CONTRACT.AIFCOW_ISSUE_STATE_CODE) AS CONTRACT_JURISDICTION_STATE_CDE,
        NULL As TAX_ACCOUNT_NR,
        NULL As READABILITY_CDE,
        NULL As SOURCE_READABILITY_CDE,
        NULL As VANTAGE_RESTRICTION_CDE,
        COALESCE(CLEAN_STRING(SUSPEND_CDE_SDT.TRNSLT_FLD_VAL), 'Unk') As SUSPEND_CDE,
        CONTRACT.AIFCOW_SUSPEND_CODE AS SOURCE_SUSPEND_CDE,
        NULL AS SOURCE_PRODUCT_SHORT_NM,
        NULL AS SOURCE_PRODUCT_LONG_NM,
        CLEAN_STRING(CONTRACT.AIFCOW_SPECIAL_HANDLG_CODE) As SPECIAL_HANDLING_CDE,
        CONTRACT.AIFCOW_SPECIAL_HANDLG_CODE As SOURCE_SPECIAL_HANDLING_CDE,
        COALESCE(CLEAN_STRING(ISSUE_REASON_CDE_SDT.TRNSLT_FLD_VAL), 'Unk') As ISSUE_REASON_CDE,
        CONTRACT.AIFCOW_PURPOSE_OF_SALE_CODE As SOURCE_ISSUE_REASON_CDE,
        NULL As CDSC_PERIOD_YEAR_NR,
		CASE WHEN TO_CHAR(CONTRACT.AIFCOW_RENEWAL_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_RENEWAL_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_RENEWAL_DD),2,'0')
		=99999999 OR TO_CHAR(CONTRACT.AIFCOW_RENEWAL_YYYY)
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_RENEWAL_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_RENEWAL_DD),2,'0')
		>52000000 THEN TO_DATE('9999-12-31','YYYY-MM-DD') 
		ELSE PUBLIC.ISDATE((TO_CHAR(CONTRACT.AIFCOW_RENEWAL_YYYY))
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_RENEWAL_MM),2,'0')
		||LPAD(TO_CHAR(CONTRACT.AIFCOW_RENEWAL_DD),2,'0')) 
		END As RENEWAL_DT,
        NULL AS RETIRE_GUARD_IND,
        NULL As SOURCE_ADMIN_ERROR_CDE,
        NULL As SOURCE_PENDING_ACTIVITY_CDE,
        CONTRACT.AIFCOW_POLICY_ID AS SOURCE_AGREEMENT_NR,
        NULL AS WORKSITE_IND,
        NULL AS PRODUCT_GROUP_CDE,
        NULL As UPDATE_STATE_CDE,
        NULL AS AGENCY_SUSPEND_ITEM_CDE,
        CLEAN_STRING(CONTRACT.AIFCOW_DIST_CLIENT_ACCT_ID) As DISTRIBUTOR_CLIENT_ACCOUNT_ID,
        CLEAN_STRING(CONTRACT.AIFCOW_RESIDENT_STATE) As RESIDENT_STATE_CDE,
        NULL As SOLICITATION_STATE_CDE,
        CLEAN_STRING(CONTRACT.AIFCOW_DISTRIB_CHANNEL) As DISTRIBUTION_CHANNEL_CDE,
        CONTRACT.AIFCOW_DISTRIB_CHANNEL As SOURCE_DISTRIBUTION_CHANNEL_CDE,
        CLEAN_STRING(CONTRACT.AIFCOW_FAV_CODE) As PRODUCT_TIER_CDE,
        COALESCE(CLEAN_STRING(REPLACEMENT_CDE_SDT.TRNSLT_FLD_VAL), 'Unk') As REPLACEMENT_CDE,
        CONTRACT.AIFCOW_RPS_REPLACEMENT_TYPE As SOURCE_REPLACEMENT_CDE,
        NULL As SPECIAL_CONDITION_CDE,
        NULL As SPECIAL_CONDITION_REASON_CDE,
        NULL As SPECIAL_CONDITION_CATEGORY_CDE,
        NULL As SPECIAL_CONDITION_2_CDE,
        NULL As SPECIAL_CONDITION_2_REASON_CDE,
        NULL As SPECIAL_CONDITION_2_CATEGORY_CDE,
        NULL As SPM_GROUP_BILLED_SUSPENSE_IND,
        NULL As SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
        NULL As SPM_GROUP_AR_SUSPENSE_IND,
        NULL As ACTIVELY_AT_WORK_IND,
        NULL As MARKET_GROUP_CDE,
        NULL As PT_TRANS_TO_INSD_DT,
        NULL As MANAGERIAL_IND,
        NULL As INIT_PD_TO_DT,
        NULL As INSURED_INTERESTED_PARTY_NR_TXT,
        NULL As ISSUE_STATE_CDE,
        NULL As LAPSE_DT,
        NULL As CONVERSION_STATUS_CDE,
        NULL As LAST_ANNIVERSARY_DT,
        NULL As NEXT_ANNIVERSARY_DT,
        NULL As INSURED_ISSUE_AGE_NR,
        NULL As SMOKER_CDE,
        NULL AS MEC_CDE,
        NULL AS SOURCE_MEC_CDE,
        NULL As PLAN_YEAR_NR,
        NULL As PLAN_MONTH_NR,
        NULL As AGREEMENT_CUSIP_CDE,
		NULL AS AGREEMENT_DIVIDEND_OPTION_CDE,
        NULL AS SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
        NULL AS APL_CDE,
        NULL As BASE_FACE_RATING_NR,
        NULL As BASE_TEMPORARY_PREMIUM_AMT,
        NULL As BASE_TEMPORARY_DURATION_NR,
        NULL As BASE_PERMANENT_PREMIUM_AMT,
        NULL As BASE_FACE_AMT,
        NULL As ACTIVITY_PENDING_CDE,
        NULL As ACTIVITY_PENDING_DESC,
        NULL As SOURCE_ACTIVITY_PENDING_DESC,
        NULL AS APD_IND,
        NULL AS SOURCE_APD_IND,
        NULL AS APM_NR_TXT,
        NULL AS SOURCE_APM_NR_TXT,
        NULL AS SOURCE_APL_CDE,
        NULL AS CONVERSION_IND,
        NULL AS SOURCE_CONVERSION_IND,
        NULL AS CONVERTED_POLICY_TYPE_CDE,
        NULL AS SOURCE_CONVERTED_POLICY_TYPE_CDE,
        NULL As CONVERTED_POLICY_NR_TXT,
        NULL AS ACTIVITY_CDE,
        NULL As DELIVERY_DATA_CDE,
        NULL As SOURCE_DELIVERY_DATA_CDE,
        NULL As BENEFIT_AMT,
        NULL AS DEATH_BENEFIT_OPTION_CDE,
        NULL AS DEATH_BENEFIT_OPTION_INTEREST_RT,
        NULL AS DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
        NULL As EXCHANGE_PROVISION_CDE,
        NULL As SOURCE_EXCHANGE_PROVISION_CDE,
        NULL AS FREE_LOOK_EXPIRY_DT,
        NULL As INSURANCE_ANNUITY_CDE,
        NULL As SOURCE_INSURANCE_ANNUITY_CDE,
        NULL AS LUMP_SUM_BENEFIT_AMT,
        NULL AS MEC_EFFECTIVE_DT,
        NULL AS MEC_STATUS_CDE,
        NULL AS SOURCE_MEC_STATUS_CDE,
        NULL AS NON_FORFEITURE_OPTION_CDE,
        NULL As ADMSPEC_CDE,
        NULL As SOURCE_ADMSPEC_CDE,
        NULL AS PURPOSE_OF_INSURANCE_CATEGORY_CDE,
        NULL AS PURPOSE_OF_INSURANCE_CDE,
        NULL AS PEND_SETTLE_CDE, 
        NULL AS REINSURED_CDE,
        NULL AS SOURCE_REINSURED_CDE,
        NULL AS TEMPORARY_TERM_PRE_EFFECTIVE_DT,
        NULL AS TEMPORARY_TERM_STATUS_CDE,
        NULL AS YEARLY_TERM_PURCHASE_CDE,
        NULL AS POLICY_LAPSE_DT,
        NULL AS DBO_SHORT_NM,
        NULL AS MEC_EFFECTIVE_DT_QUALITY_CDE,
        NULL AS VLR_RC,
        NULL As TELEPHONE_AUTHORIZATION_CDE,
        NULL As TAX_AGG_CDE,
        NULL As SOURCE_TAX_AGG_CDE,
        NULL As TAX_AMT_NOT_DETERMINED_IND,
        NULL As ASSIGN_DT,
        NULL As EARLIEST_PERMITTED_ANNUITY_DT,
        NULL As LATEST_PERMITTED_ANNUITY_DT,
        NULL As SOURCE_TELEPHONE_AUTHORIZATION_CDE,
        NULL As WITHDRAWAL_OPTION_CDE,
        NULL As SOURCE_WITHDRAWAL_OPTION_CDE,
        NULL As GLWB_STATUS_CDE,
        NULL As SOURCE_GLWB_STATUS_CDE,
        NULL As GLWB_STATUS_DT,
        NULL As REINSURANCE_TREATY_NR_TXT,
        NULL As EXCESS_WITHDRAWAL_CDE,
        NULL As SOURCE_EXCESS_WITHDRAWAL_CDE,
        NULL As VI_RIDER_IND,
        NULL As PORTABILITY_IND,
		NULL AS AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
		NULL AS SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
		NULL AS AGREEMENT_DIVIDEND_OPTION_DESC,
		NULL AS AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
        CASE WHEN CLEAN_STRING(CONTRACT.PROCESSED_IND) = 'D' THEN TRUE ELSE FALSE END AS SOURCE_DELETE_IND,
        NULL AS SOURCE_PRODUCT_TYPE_CDE,
		NULL AS PERSISTENCY_CREDIT_CDE,
		NULL AS SOURCE_PERSISTENCY_CREDIT_CDE,
		NULL AS PERSISTENCY_CREDIT_START_DT,
		NULL AS DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
    FROM
        (SELECT DELTA.*,
		TO_DATE(CNT.CYCLE_DATE::VARCHAR , 'YYYYMMDD') AS BEGIN_DT FROM
        (SELECT * FROM EDW_STAGING.AIF_RPS_EDW_CTRT_FULL_DEDUP 
		UNION 
		SELECT * FROM EDW_STAGING.AIF_RPS_EDW_CTRT_DELTA_DEDUP 
		WHERE PROCESSED_IND='D') DELTA,
        EDW_STAGING.AIF_RPS_EDW_CTRT_DELTA_COUNT CNT
        ) CONTRACT
/*	LEFT JOIN(
    SELECT AGREEMENT_NR,BEGIN_DT, AGREEMENT_STATUS_CDE,
        AGREEMENT_STATUS_REASON_CDE,AGREEMENT_STATUS_DT,
        AGREEMENT_NR_PFX, AGREEMENT_NR_SFX
        FROM {{target_schema}}.DIM_AGREEMENT
        WHERE UPPER(AGREEMENT_SOURCE_CDE)='RPS'
        AND SOURCE_SYSTEM_ID IN ('266','72')
        AND CURRENT_ROW_IND='TRUE') DIM
    ON COALESCE(CLEAN_STRING(PUBLIC.UDF_AIF_HLDG_KEY_FORMAT(CONTRACT.AIFCOW_POLICY_ID,'PFX')),'')=COALESCE(CLEAN_STRING(DIM.AGREEMENT_NR_PFX),'')
    AND COALESCE(PUBLIC.UDF_AIF_HLDG_KEY_FORMAT(CONTRACT.AIFCOW_POLICY_ID,'KEY'),'')=COALESCE(DIM.AGREEMENT_NR,'')
    AND COALESCE(CLEAN_STRING(PUBLIC.UDF_AIF_HLDG_KEY_FORMAT(CONTRACT.AIFCOW_POLICY_ID,'SFX')),'')=COALESCE(CLEAN_STRING(DIM.AGREEMENT_NR_SFX),'')
    AND UPPER(CONTRACT.AIFCOW_SOURCE_SYSTEM_ID)='RPS' */
	LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='ANN'
    AND UPPER(BTRIM(SRC_FLD_NM))='ADMN_SYS_CDE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'ADMIN OR SOURCE SYSTEM CODE') AGREEMENT_SDT
    ON UPPER(BTRIM(AGREEMENT_SDT.SRC_FLD_VAL)) = UPPER(TRIM(COALESCE(LTRIM(RTRIM(CONTRACT.AIFCOW_SOURCE_SYSTEM_ID)), '')))
    LEFT JOIN EDW_REF.PRODUCT_TRANSLATOR PRODUCT_DT
    ON CLEAN_STRING(TRIM(CONTRACT.AIFCOW_PLAN_CODE)) >= CLEAN_STRING(TRIM(PRODUCT_DT.KND_MIN_CDE))
    AND CLEAN_STRING(TRIM(CONTRACT.AIFCOW_PLAN_CODE)) <= CLEAN_STRING(TRIM(PRODUCT_DT.KND_MAX_CDE))
--    AND CLEAN_STRING(LPAD(LTRIM(COALESCE(BTRIM(CONTRACT.CTRT_BASIS), ''), '0'), 2, '0')) >= CLEAN_STRING(TRIM(PRODUCT_DT.BSIS_MIN_CDE))
--    AND CLEAN_STRING(LPAD(LTRIM(COALESCE(BTRIM(CONTRACT.CTRT_BASIS), ''), '0'), 2, '0')) <= CLEAN_STRING(TRIM(PRODUCT_DT.BSIS_MAX_CDE))
	AND '00' >= CLEAN_STRING(TRIM(PRODUCT_DT.BSIS_MIN_CDE))
	AND '00' <= CLEAN_STRING(TRIM(PRODUCT_DT.BSIS_MAX_CDE))
	AND '0000' >= CLEAN_STRING(TRIM(PRODUCT_DT.RATE_MIN_CDE))
    AND '0000' <= CLEAN_STRING(TRIM(PRODUCT_DT.RATE_MAX_CDE))
--    AND CLEAN_STRING(LPAD(LTRIM(COALESCE(BTRIM(CONTRACT.CTRT_RATE_EDITION), ''), '0'), 4, '0')) >= CLEAN_STRING(TRIM(PRODUCT_DT.RATE_MIN_CDE))
--    AND CLEAN_STRING(LPAD(LTRIM(COALESCE(BTRIM(CONTRACT.CTRT_RATE_EDITION), ''), '0'), 4, '0')) <= CLEAN_STRING(TRIM(PRODUCT_DT.RATE_MAX_CDE))
    AND PRODUCT_DT.ADMN_SYS_GRP_CDE = '02'
    LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='RPS'
    AND UPPER(BTRIM(SRC_FLD_NM))='LOB_CODE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'MARKET TYPE CODE') MARKET_SDT
    ON UPPER(BTRIM(MARKET_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_LOB_CODE, 'SPACE'))
    LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='RPS'
    AND UPPER(BTRIM(SRC_FLD_NM))='RESTRICTION_CODE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'RESTRICTION REASON CODE') RESTRICT_CD_SDT
    ON UPPER(BTRIM(RESTRICT_CD_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_RESTRICTION_CODE, 'SPACE'))
    LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='ANN'
    AND UPPER(BTRIM(SRC_FLD_NM))='REPLACEMENT_CODE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'REPLACEMENT CODE') REPLACEMENT_TYPE_CDE_SDT
    ON UPPER(BTRIM(REPLACEMENT_TYPE_CDE_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_RPS_REPLACEMENT_TYPE, 'SPACE'))
    LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='RPS'
    AND UPPER(BTRIM(SRC_FLD_NM))='SUSPENSE_CODE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'SUSPENSE INDICATOR') HOME_OFFICE_AMOUNT_SUSPEND_SDT
    ON UPPER(BTRIM(HOME_OFFICE_AMOUNT_SUSPEND_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_SUSPENSE_CODE, 'SPACE'))
    LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='RPS'
    AND UPPER(BTRIM(SRC_FLD_NM))='CONTRACT_STATUS_CODE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'STATUS CODE' ) AGREEMENT_STATUS_CDE_SDT
    ON UPPER(BTRIM(AGREEMENT_STATUS_CDE_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_CONTRACT_STATUS_CODE, 'SPACE'))
	LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='RPS'
    AND UPPER(BTRIM(SRC_FLD_NM))='CONTRACT_STATUS_CODE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'STATUS REASON CODE' ) AGREEMENT_STATUS_RSN_CDE_SDT
    ON UPPER(BTRIM(AGREEMENT_STATUS_RSN_CDE_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_CONTRACT_STATUS_CODE, 'SPACE'))
	LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='RPS'
    AND UPPER(BTRIM(SRC_FLD_NM))='MKT-CD'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'MARKET QUALIFIED INDICATOR') TAX_QUALIFIED_CDE_SDT
    ON UPPER(BTRIM(TAX_QUALIFIED_CDE_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_LOB_CODE,'SPACE'))
	LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='RPS'
    AND UPPER(BTRIM(SRC_FLD_NM))='COMPANY-CD'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'COMPANY NUMERICAL CODE') COMPANY_CDE_SDT
    ON UPPER(BTRIM(COMPANY_CDE_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_COMPANY_CODE,'SPACE'))
	LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='RPS'
    AND UPPER(BTRIM(SRC_FLD_NM))='SUSPEND_CODE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'SUSPEND CODE') SUSPEND_CDE_SDT
    ON UPPER(BTRIM(SUSPEND_CDE_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_SUSPEND_CODE,'SPACE'))
	LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='ANN'
    AND UPPER(BTRIM(SRC_FLD_NM))='ISS_RSN'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'ISSUE REASON') ISSUE_REASON_CDE_SDT
    ON UPPER(BTRIM(ISSUE_REASON_CDE_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_PURPOSE_OF_SALE_CODE,'SPACE'))
	LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='ANN'
    AND UPPER(BTRIM(SRC_FLD_NM))='REPLACEMENT_CODE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'REPLACEMENT INDICATOR') REPLACEMENT_CDE_SDT
    ON UPPER(BTRIM(REPLACEMENT_CDE_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_RPS_REPLACEMENT_TYPE,'SPACE'))
/*	LEFT JOIN (SELECT DISTINCT TRNSLT_FLD_VAL,SRC_CDE,SRC_FLD_NM,TRNSLT_FLD_NM,SRC_FLD_VAL FROM EDW_REF.SRC_DATA_TRNSLT
    WHERE UPPER(BTRIM(SRC_CDE))='RPS'
    AND UPPER(BTRIM(SRC_FLD_NM))='WDRWL_OPT_CODE'
    AND UPPER(BTRIM(TRNSLT_FLD_NM)) = 'WITHDRAWL OPTION CODE') WITHDRAWAL_OPTION_CDE_SDT
    ON UPPER(BTRIM(WITHDRAWAL_OPTION_CDE_SDT.SRC_FLD_VAL)) = UPPER(UDF_REPLACEEMPTYSTR(CONTRACT.AIFCOW_WDRWL_OPT_CODE,'SPACE'))*/
) SRC ;

-- Step 2: get newly added records to work table. this may cover the cases where it is marked as 'C', but no
-- UUID existing in target side.
INSERT INTO EDW_WORK.AIFRPS_DIM_AGREEMENT
    (
    DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    MASTER_CONTRACT_GROUP_ID,
    SPONSOR_ID,
    PLAN_ID,
    SUBSCRIBER_ID,
    PARTICIPANT_ID,
    ICU_ID,
    MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC,
    PLAN_NM_1_TXT,
    PLAN_NM_2_TXT,
    PLAN_NM_3_TXT,
    SUBSCRIBER_NR,
    AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    ALLOW_ROLLOVER_IND,
    APPLICATION_SUBMIT_DT,
    BENEFICIARIES_RECORDED_IND,
    CONVERSION_EXPIRED_IND,
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    DEFAULT_VOLUNTARY_DEFERRAL_RT,
    ENROLLMENT_DT,
    ENROLLMENT_ELIGIBILITY_DT,
    ENROLLMENT_START_DT,
    ENROLLMENT_END_DT,
    ENROLLMENT_STATUS_CDE,
    ENROLLMENT_TYPE_CDE,
    FACE_AMT,
    INTERNAL_PLAN_ID,
    ISSUE_DT,
    PARTICIPATION_DT,
    SOLICITATION_DT,
    SOLICITATION_IND,
    TAFT_HARTLY_IND,
    ELECTRONIC_CONTRIBUTION_CHANGE_IND,
    PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
    BEGIN_DT,
    BEGIN_DTM,
    ROW_PROCESS_DTM,
    AUDIT_ID,
    LOGICAL_DELETE_IND,
    CHECK_SUM,
    CURRENT_ROW_IND,
    END_DT,
    END_DTM,
    SOURCE_SYSTEM_ID,
    RESTRICTED_ROW_IND,
    --ROW_SID,
    NEXT_PAYMENT_DT,
    NEXT_PAYMENT_AMT,
    CURRENT_PRINCIPAL_AMT,
    LOAN_BOOKED_COUPON_RT,
    LOAN_BOOKED_AMT,
    LOAN_REQUESTED_COUPON_RT,
    LOAN_REQUESTED_AMT,
    LOAN_MONTHS_TO_MATURITY_VAL,
    LOAN_DEGREE_PROGRAM_DESC,
    DECISIONING_ANNUAL_INCOME_AMT,
    APPLICATION_STATUS_DT,
    LOAN_REPORT_UNIQUE_HASH_ID,
    ESERVICE_IND,
    AGREEMENT_EFFECTIVE_DT,
    UPDATE_AUDIT_ID,
    TERMINATED_PARTICIPANT_SERVICING_IND,
    MANAGED_ACCOUNTS_ELIGIBILITY_IND,
    MANAGED_ACCOUNTS_PARTICIPATION_IND,
	MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
    SOURCE_AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_CATEGORY_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_PLAN_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    SOURCE_READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_AGREEMENT_NR,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    ISSUE_STATE_CDE,
    LAPSE_DT,
    CONVERSION_STATUS_CDE,
    LAST_ANNIVERSARY_DT,
    NEXT_ANNIVERSARY_DT,
    INSURED_ISSUE_AGE_NR,
    SMOKER_CDE,
    MEC_CDE,
    SOURCE_MEC_CDE,
    PLAN_YEAR_NR,
    PLAN_MONTH_NR,
    AGREEMENT_CUSIP_CDE,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    APL_CDE,
    BASE_FACE_RATING_NR,
    BASE_TEMPORARY_PREMIUM_AMT,
    BASE_TEMPORARY_DURATION_NR,
    BASE_PERMANENT_PREMIUM_AMT,
    BASE_FACE_AMT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    exchange_provision_cde,
    SOURCE_exchange_provision_cde,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    SOURCE_DELETE_IND,
    SOURCE_PRODUCT_TYPE_CDE,
	PERSISTENCY_CREDIT_CDE,
	SOURCE_PERSISTENCY_CREDIT_CDE,
	PERSISTENCY_CREDIT_START_DT,
	DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
    )
SELECT
        DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
        AGREEMENT_NR_PFX,
        AGREEMENT_NR,
        AGREEMENT_NR_SFX,
        AGREEMENT_SOURCE_CDE,
        AGREEMENT_TYPE_CDE,
        MASTER_CONTRACT_GROUP_ID,
        SPONSOR_ID,
        PLAN_ID,
        SUBSCRIBER_ID,
        PARTICIPANT_ID,
        ICU_ID,
        MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC,
        PLAN_NM_1_TXT,
        PLAN_NM_2_TXT,
        PLAN_NM_3_TXT,
        SUBSCRIBER_NR,
        AGREEMENT_STATUS_CDE,
        AGREEMENT_STATUS_REASON_CDE,
        ALLOW_ROLLOVER_IND,
        APPLICATION_SUBMIT_DT,
        BENEFICIARIES_RECORDED_IND,
        CONVERSION_EXPIRED_IND,
        CONVERSION_ELIGIBILITY_START_DT,
        CONVERSION_ELIGIBILITY_END_DT,
        DEFAULT_VOLUNTARY_DEFERRAL_RT,
        ENROLLMENT_DT,
        ENROLLMENT_ELIGIBILITY_DT,
        ENROLLMENT_START_DT,
        ENROLLMENT_END_DT,
        ENROLLMENT_STATUS_CDE,
        ENROLLMENT_TYPE_CDE,
        FACE_AMT,
        INTERNAL_PLAN_ID,
        ISSUE_DT,
        PARTICIPATION_DT,
        SOLICITATION_DT,
        SOLICITATION_IND,
        TAFT_HARTLY_IND,
        ELECTRONIC_CONTRIBUTION_CHANGE_IND,
        PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
        BEGIN_DT,
        BEGIN_DTM,
        ROW_PROCESS_DTM,
        :audit_id,
        LOGICAL_DELETE_IND,
        CHECK_SUM,
        CURRENT_ROW_IND,
        END_DT,
        END_DTM,
        SOURCE_SYSTEM_ID,
        RESTRICTED_ROW_IND,
        --ROW_SID,
        NEXT_PAYMENT_DT,
        NEXT_PAYMENT_AMT,
        CURRENT_PRINCIPAL_AMT,
        LOAN_BOOKED_COUPON_RT,
        LOAN_BOOKED_AMT,
        LOAN_REQUESTED_COUPON_RT,
        LOAN_REQUESTED_AMT,
        LOAN_MONTHS_TO_MATURITY_VAL,
        LOAN_DEGREE_PROGRAM_DESC,
        DECISIONING_ANNUAL_INCOME_AMT,
        APPLICATION_STATUS_DT,
        LOAN_REPORT_UNIQUE_HASH_ID,
        ESERVICE_IND,
        AGREEMENT_EFFECTIVE_DT,
        :audit_id,
        TERMINATED_PARTICIPANT_SERVICING_IND,
        MANAGED_ACCOUNTS_ELIGIBILITY_IND,
        MANAGED_ACCOUNTS_PARTICIPATION_IND,
		MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
        SOURCE_AGREEMENT_STATUS_CDE,
        SOURCE_AGREEMENT_STATUS_REASON_CDE,
        SOURCE_AGREEMENT_STATUS_CATEGORY_CDE,
        AGREEMENT_STATUS_DT,
        DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
        PT1_KIND_CDE,
        PT2_ISSUE_BASIS_CDE,
        PT3_RATE_CDE,
        MATURITY_DT,
        ANNIVERSARY_DT,
        TERMINATION_DT,
        APPLICATION_RECEIVED_DT,
        APPLICATION_SIGNED_DT,
        MARKET_CATEGORY_TYPE_CDE,
        SOURCE_PLAN_TYPE_CDE,
        SOURCE_MARKET_CATEGORY_TYPE_CDE,
        TAX_QUALIFIED_CDE,
        SOURCE_TAX_QUALIFIED_CDE,
        REPLACEMENT_TYPE_CDE,
        SOURCE_REPLACEMENT_TYPE_CDE,
        RESTRICTION_CDE,
        SOURCE_RESTRICTION_CDE,
        RESTRICTION_CATEGORY_CDE,
        SOURCE_RESTRICTION_CATEGORY_CDE,
        COMPANY_CDE,
        SOURCE_COMPANY_CDE,
        FROZEN_CDE,
        SOURCE_FROZEN_CDE,
        HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        LOST_INSURED_IND,
        SOURCE_LOST_INSURED_IND,
        TITLE_MESSAGE_TXT,
        OFFER_ACCEPTANCE_CDE,
        SOURCE_OFFER_ACCEPTANCE_CDE,
        VARIABLE_PRODUCT_CDE,
        CONTRACT_JURISDICTION_STATE_CDE,
        TAX_ACCOUNT_NR,
        READABILITY_CDE,
        SOURCE_READABILITY_CDE,
        VANTAGE_RESTRICTION_CDE,
        SUSPEND_CDE,
        SOURCE_SUSPEND_CDE,
        SOURCE_PRODUCT_SHORT_NM,
        SOURCE_PRODUCT_LONG_NM,
        SPECIAL_HANDLING_CDE,
        SOURCE_SPECIAL_HANDLING_CDE,
        ISSUE_REASON_CDE,
        SOURCE_ISSUE_REASON_CDE,
        CDSC_PERIOD_YEAR_NR,
        RENEWAL_DT,
        RETIRE_GUARD_IND,
        SOURCE_ADMIN_ERROR_CDE,
        SOURCE_PENDING_ACTIVITY_CDE,
        SOURCE_AGREEMENT_NR,
        WORKSITE_IND,
        PRODUCT_GROUP_CDE,
        UPDATE_STATE_CDE,
        AGENCY_SUSPEND_ITEM_CDE,
        DISTRIBUTOR_CLIENT_ACCOUNT_ID,
        RESIDENT_STATE_CDE,
        SOLICITATION_STATE_CDE,
        DISTRIBUTION_CHANNEL_CDE,
        SOURCE_DISTRIBUTION_CHANNEL_CDE,
        PRODUCT_TIER_CDE,
        REPLACEMENT_CDE,
        SOURCE_REPLACEMENT_CDE,
        SPECIAL_CONDITION_CDE,
        SPECIAL_CONDITION_REASON_CDE,
        SPECIAL_CONDITION_CATEGORY_CDE,
        SPECIAL_CONDITION_2_CDE,
        SPECIAL_CONDITION_2_REASON_CDE,
        SPECIAL_CONDITION_2_CATEGORY_CDE,
        SPM_GROUP_BILLED_SUSPENSE_IND,
        SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
        SPM_GROUP_AR_SUSPENSE_IND,
        ACTIVELY_AT_WORK_IND,
        MARKET_GROUP_CDE,
        PT_TRANS_TO_INSD_DT,
        MANAGERIAL_IND,
        INIT_PD_TO_DT,
        INSURED_INTERESTED_PARTY_NR_TXT,
        ISSUE_STATE_CDE,
        LAPSE_DT,
        CONVERSION_STATUS_CDE,
        LAST_ANNIVERSARY_DT,
        NEXT_ANNIVERSARY_DT,
        INSURED_ISSUE_AGE_NR,
        SMOKER_CDE,
        MEC_CDE,
        SOURCE_MEC_CDE,
        PLAN_YEAR_NR,
        PLAN_MONTH_NR,
        AGREEMENT_CUSIP_CDE,
        AGREEMENT_DIVIDEND_OPTION_CDE,
        SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
        APL_CDE,
        BASE_FACE_RATING_NR,
        BASE_TEMPORARY_PREMIUM_AMT,
        BASE_TEMPORARY_DURATION_NR,
        BASE_PERMANENT_PREMIUM_AMT,
        BASE_FACE_AMT,
        ACTIVITY_PENDING_CDE,
        ACTIVITY_PENDING_DESC,
        SOURCE_ACTIVITY_PENDING_DESC,
        APD_IND,
        SOURCE_APD_IND,
        APM_NR_TXT,
        SOURCE_APM_NR_TXT,
        SOURCE_APL_CDE,
        CONVERSION_IND,
        SOURCE_CONVERSION_IND,
        CONVERTED_POLICY_TYPE_CDE,
        SOURCE_CONVERTED_POLICY_TYPE_CDE,
        CONVERTED_POLICY_NR_TXT,
        ACTIVITY_CDE,
        DELIVERY_DATA_CDE,
        SOURCE_DELIVERY_DATA_CDE,
        BENEFIT_AMT,
        DEATH_BENEFIT_OPTION_CDE,
        DEATH_BENEFIT_OPTION_INTEREST_RT,
        DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
        exchange_provision_cde,
        SOURCE_exchange_provision_cde,
        FREE_LOOK_EXPIRY_DT,
        INSURANCE_ANNUITY_CDE,
        SOURCE_INSURANCE_ANNUITY_CDE,
        LUMP_SUM_BENEFIT_AMT,
        MEC_EFFECTIVE_DT,
        MEC_STATUS_CDE,
        SOURCE_MEC_STATUS_CDE,
        NON_FORFEITURE_OPTION_CDE,
        ADMSPEC_CDE,
        SOURCE_ADMSPEC_CDE,
        PURPOSE_OF_INSURANCE_CATEGORY_CDE,
        PURPOSE_OF_INSURANCE_CDE,
        PEND_SETTLE_CDE,
        REINSURED_CDE,
        SOURCE_REINSURED_CDE,
        TEMPORARY_TERM_PRE_EFFECTIVE_DT,
        TEMPORARY_TERM_STATUS_CDE,
        YEARLY_TERM_PURCHASE_CDE,
        POLICY_LAPSE_DT,
        DBO_SHORT_NM,
        MEC_EFFECTIVE_DT_QUALITY_CDE,
        VLR_RC,
        TELEPHONE_AUTHORIZATION_CDE,
        TAX_AGG_CDE,
        SOURCE_TAX_AGG_CDE,
        TAX_AMT_NOT_DETERMINED_IND,
        ASSIGN_DT,
        EARLIEST_PERMITTED_ANNUITY_DT,
        LATEST_PERMITTED_ANNUITY_DT,
        SOURCE_TELEPHONE_AUTHORIZATION_CDE,
        WITHDRAWAL_OPTION_CDE,
        SOURCE_WITHDRAWAL_OPTION_CDE,
        GLWB_STATUS_CDE,
        SOURCE_GLWB_STATUS_CDE,
        GLWB_STATUS_DT,
        REINSURANCE_TREATY_NR_TXT,
        EXCESS_WITHDRAWAL_CDE,
        SOURCE_EXCESS_WITHDRAWAL_CDE,
        VI_RIDER_IND,
        PORTABILITY_IND,
        AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        AGREEMENT_DIVIDEND_OPTION_DESC,
        AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
        SOURCE_DELETE_IND,
        SOURCE_PRODUCT_TYPE_CDE,
		PERSISTENCY_CREDIT_CDE,
		SOURCE_PERSISTENCY_CREDIT_CDE,
		PERSISTENCY_CREDIT_START_DT,
		DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
FROM EDW_STAGING.AIFRPS_DIM_AGREEMENT_PRE_WORK SRC
WHERE SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID
NOT IN (SELECT DISTINCT DIM_AGREEMENT_NATURAL_KEY_HASH_UUID FROM {{target_schema}}.dim_agreement WHERE LOGICAL_DELETE_IND = FALSE);


-- Step3 get updated record from target table.
-- if running to performance issue, may consider IN operator instead of joining in the bottom.
INSERT INTO EDW_WORK.AIFRPS_DIM_AGREEMENT
    (
    DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    MASTER_CONTRACT_GROUP_ID,
    SPONSOR_ID,
    PLAN_ID,
    SUBSCRIBER_ID,
    PARTICIPANT_ID,
    ICU_ID,
    MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC,
    PLAN_NM_1_TXT,
    PLAN_NM_2_TXT,
    PLAN_NM_3_TXT,
    SUBSCRIBER_NR,
    AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    ALLOW_ROLLOVER_IND,
    APPLICATION_SUBMIT_DT,
    BENEFICIARIES_RECORDED_IND,
    CONVERSION_EXPIRED_IND,
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    DEFAULT_VOLUNTARY_DEFERRAL_RT,
    ENROLLMENT_DT,
    ENROLLMENT_ELIGIBILITY_DT,
    ENROLLMENT_START_DT,
    ENROLLMENT_END_DT,
    ENROLLMENT_STATUS_CDE,
    ENROLLMENT_TYPE_CDE,
    FACE_AMT,
    INTERNAL_PLAN_ID,
    ISSUE_DT,
    PARTICIPATION_DT,
    SOLICITATION_DT,
    SOLICITATION_IND,
    TAFT_HARTLY_IND,
    ELECTRONIC_CONTRIBUTION_CHANGE_IND,
    PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
    BEGIN_DT,
    BEGIN_DTM,
    ROW_PROCESS_DTM,
    AUDIT_ID,
    LOGICAL_DELETE_IND,
    CHECK_SUM,
    CURRENT_ROW_IND,
    END_DT,
    END_DTM,
    SOURCE_SYSTEM_ID,
    RESTRICTED_ROW_IND,
    --ROW_SID,
    NEXT_PAYMENT_DT,
    NEXT_PAYMENT_AMT,
    CURRENT_PRINCIPAL_AMT,
    LOAN_BOOKED_COUPON_RT,
    LOAN_BOOKED_AMT,
    LOAN_REQUESTED_COUPON_RT,
    LOAN_REQUESTED_AMT,
    LOAN_MONTHS_TO_MATURITY_VAL,
    LOAN_DEGREE_PROGRAM_DESC,
    DECISIONING_ANNUAL_INCOME_AMT,
    APPLICATION_STATUS_DT,
    LOAN_REPORT_UNIQUE_HASH_ID,
    ESERVICE_IND,
    AGREEMENT_EFFECTIVE_DT,
    UPDATE_AUDIT_ID,
    TERMINATED_PARTICIPANT_SERVICING_IND,
    MANAGED_ACCOUNTS_ELIGIBILITY_IND,
    MANAGED_ACCOUNTS_PARTICIPATION_IND,
	MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
    SOURCE_AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_CATEGORY_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_PLAN_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    SOURCE_READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_AGREEMENT_NR,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    ISSUE_STATE_CDE,
    LAPSE_DT,
    CONVERSION_STATUS_CDE,
    LAST_ANNIVERSARY_DT,
    NEXT_ANNIVERSARY_DT,
    INSURED_ISSUE_AGE_NR,
    SMOKER_CDE,
    MEC_CDE,
    SOURCE_MEC_CDE,
    PLAN_YEAR_NR,
    PLAN_MONTH_NR,
    AGREEMENT_CUSIP_CDE,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    APL_CDE,
    BASE_FACE_RATING_NR,
    BASE_TEMPORARY_PREMIUM_AMT,
    BASE_TEMPORARY_DURATION_NR,
    BASE_PERMANENT_PREMIUM_AMT,
    BASE_FACE_AMT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    exchange_provision_cde,
    SOURCE_exchange_provision_cde,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    SOURCE_DELETE_IND,
    SOURCE_PRODUCT_TYPE_CDE,
	PERSISTENCY_CREDIT_CDE,
	SOURCE_PERSISTENCY_CREDIT_CDE,
	PERSISTENCY_CREDIT_START_DT,
	DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
    )
SELECT
        TGT.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
        TGT.AGREEMENT_NR_PFX,
        TGT.AGREEMENT_NR,
        TGT.AGREEMENT_NR_SFX,
        TGT.AGREEMENT_SOURCE_CDE,
        TGT.AGREEMENT_TYPE_CDE,
        TGT.MASTER_CONTRACT_GROUP_ID,
        TGT.SPONSOR_ID,
        TGT.PLAN_ID,
        TGT.SUBSCRIBER_ID,
        TGT.PARTICIPANT_ID,
        TGT.ICU_ID,
        TGT.MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC,
        TGT.PLAN_NM_1_TXT,
        TGT.PLAN_NM_2_TXT,
        TGT.PLAN_NM_3_TXT,
        TGT.SUBSCRIBER_NR,
        TGT.AGREEMENT_STATUS_CDE,
        TGT.AGREEMENT_STATUS_REASON_CDE,
        TGT.ALLOW_ROLLOVER_IND,
        TGT.APPLICATION_SUBMIT_DT,
        TGT.BENEFICIARIES_RECORDED_IND,
        TGT.CONVERSION_EXPIRED_IND,
        TGT.CONVERSION_ELIGIBILITY_START_DT,
        TGT.CONVERSION_ELIGIBILITY_END_DT,
        TGT.DEFAULT_VOLUNTARY_DEFERRAL_RT,
        TGT.ENROLLMENT_DT,
        TGT.ENROLLMENT_ELIGIBILITY_DT,
        TGT.ENROLLMENT_START_DT,
        TGT.ENROLLMENT_END_DT,
        TGT.ENROLLMENT_STATUS_CDE,
        TGT.ENROLLMENT_TYPE_CDE,
        TGT.FACE_AMT,
        TGT.INTERNAL_PLAN_ID,
        TGT.ISSUE_DT,
        TGT.PARTICIPATION_DT,
        TGT.SOLICITATION_DT,
        TGT.SOLICITATION_IND,
        TGT.TAFT_HARTLY_IND,
        TGT.ELECTRONIC_CONTRIBUTION_CHANGE_IND,
        TGT.PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
        TGT.BEGIN_DT,
        TGT.BEGIN_DTM,
        CURRENT_TIMESTAMP(6) AS ROW_PROCESS_DTM,
        TGT.AUDIT_ID,
        TGT.LOGICAL_DELETE_IND,
        TGT.CHECK_SUM,
        FALSE AS CURRENT_ROW_IND,
        SRC.BEGIN_DT - INTERVAL '1' DAY AS END_DT,
        SRC.BEGIN_DTM - INTERVAL '1' SECOND AS END_DTM,
        TGT.SOURCE_SYSTEM_ID,
        TGT.RESTRICTED_ROW_IND,
        --TGT.ROW_SID,
        TGT.NEXT_PAYMENT_DT,
        TGT.NEXT_PAYMENT_AMT,
        TGT.CURRENT_PRINCIPAL_AMT,
        TGT.LOAN_BOOKED_COUPON_RT,
        TGT.LOAN_BOOKED_AMT,
        TGT.LOAN_REQUESTED_COUPON_RT,
        TGT.LOAN_REQUESTED_AMT,
        TGT.LOAN_MONTHS_TO_MATURITY_VAL,
        TGT.LOAN_DEGREE_PROGRAM_DESC,
        TGT.DECISIONING_ANNUAL_INCOME_AMT,
        TGT.APPLICATION_STATUS_DT,
        TGT.LOAN_REPORT_UNIQUE_HASH_ID,
        TGT.ESERVICE_IND,
        TGT.AGREEMENT_EFFECTIVE_DT,
        :audit_id AS UPDATE_AUDIT_ID,
        TGT.TERMINATED_PARTICIPANT_SERVICING_IND,
        TGT.MANAGED_ACCOUNTS_ELIGIBILITY_IND,
        TGT.MANAGED_ACCOUNTS_PARTICIPATION_IND,
		TGT.MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
        TGT.SOURCE_AGREEMENT_STATUS_CDE,
        TGT.SOURCE_AGREEMENT_STATUS_REASON_CDE,
        TGT.SOURCE_AGREEMENT_STATUS_CATEGORY_CDE,
        TGT.AGREEMENT_STATUS_DT,
        TGT.DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
        TGT.PT1_KIND_CDE,
        TGT.PT2_ISSUE_BASIS_CDE,
        TGT.PT3_RATE_CDE,
        TGT.MATURITY_DT,
        TGT.ANNIVERSARY_DT,
        TGT.TERMINATION_DT,
        TGT.APPLICATION_RECEIVED_DT,
        TGT.APPLICATION_SIGNED_DT,
        TGT.MARKET_CATEGORY_TYPE_CDE,
        TGT.SOURCE_PLAN_TYPE_CDE,
        TGT.SOURCE_MARKET_CATEGORY_TYPE_CDE,
        TGT.TAX_QUALIFIED_CDE,
        TGT.SOURCE_TAX_QUALIFIED_CDE,
        TGT.REPLACEMENT_TYPE_CDE,
        TGT.SOURCE_REPLACEMENT_TYPE_CDE,
        TGT.RESTRICTION_CDE,
        TGT.SOURCE_RESTRICTION_CDE,
        TGT.RESTRICTION_CATEGORY_CDE,
        TGT.SOURCE_RESTRICTION_CATEGORY_CDE,
        TGT.COMPANY_CDE,
        TGT.SOURCE_COMPANY_CDE,
        TGT.FROZEN_CDE,
        TGT.SOURCE_FROZEN_CDE,
        TGT.HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        TGT.SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        TGT.LOST_INSURED_IND,
        TGT.SOURCE_LOST_INSURED_IND,
        TGT.TITLE_MESSAGE_TXT,
        TGT.OFFER_ACCEPTANCE_CDE,
        TGT.SOURCE_OFFER_ACCEPTANCE_CDE,
        TGT.VARIABLE_PRODUCT_CDE,
        TGT.CONTRACT_JURISDICTION_STATE_CDE,
        TGT.TAX_ACCOUNT_NR,
        TGT.READABILITY_CDE,
        TGT.SOURCE_READABILITY_CDE,
        TGT.VANTAGE_RESTRICTION_CDE,
        TGT.SUSPEND_CDE,
        TGT.SOURCE_SUSPEND_CDE,
        TGT.SOURCE_PRODUCT_SHORT_NM,
        TGT.SOURCE_PRODUCT_LONG_NM,
        TGT.SPECIAL_HANDLING_CDE,
        TGT.SOURCE_SPECIAL_HANDLING_CDE,
        TGT.ISSUE_REASON_CDE,
        TGT.SOURCE_ISSUE_REASON_CDE,
        TGT.CDSC_PERIOD_YEAR_NR,
        TGT.RENEWAL_DT,
        TGT.RETIRE_GUARD_IND,
        TGT.SOURCE_ADMIN_ERROR_CDE,
        TGT.SOURCE_PENDING_ACTIVITY_CDE,
        TGT.SOURCE_AGREEMENT_NR,
        TGT.WORKSITE_IND,
        TGT.PRODUCT_GROUP_CDE,
        TGT.UPDATE_STATE_CDE,
        TGT.AGENCY_SUSPEND_ITEM_CDE,
        TGT.DISTRIBUTOR_CLIENT_ACCOUNT_ID,
        TGT.RESIDENT_STATE_CDE,
        TGT.SOLICITATION_STATE_CDE,
        TGT.DISTRIBUTION_CHANNEL_CDE,
        TGT.SOURCE_DISTRIBUTION_CHANNEL_CDE,
        TGT.PRODUCT_TIER_CDE,
        TGT.REPLACEMENT_CDE,
        TGT.SOURCE_REPLACEMENT_CDE,
        TGT.SPECIAL_CONDITION_CDE,
        TGT.SPECIAL_CONDITION_REASON_CDE,
        TGT.SPECIAL_CONDITION_CATEGORY_CDE,
        TGT.SPECIAL_CONDITION_2_CDE,
        TGT.SPECIAL_CONDITION_2_REASON_CDE,
        TGT.SPECIAL_CONDITION_2_CATEGORY_CDE,
        TGT.SPM_GROUP_BILLED_SUSPENSE_IND,
        TGT.SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
        TGT.SPM_GROUP_AR_SUSPENSE_IND,
        TGT.ACTIVELY_AT_WORK_IND,
        TGT.MARKET_GROUP_CDE,
        TGT.PT_TRANS_TO_INSD_DT,
        TGT.MANAGERIAL_IND,
        TGT.INIT_PD_TO_DT,
        TGT.INSURED_INTERESTED_PARTY_NR_TXT,
        TGT.ISSUE_STATE_CDE,
        TGT.LAPSE_DT,
        TGT.CONVERSION_STATUS_CDE,
        TGT.LAST_ANNIVERSARY_DT,
        TGT.NEXT_ANNIVERSARY_DT,
        TGT.INSURED_ISSUE_AGE_NR,
        TGT.SMOKER_CDE,
        TGT.MEC_CDE,
        TGT.SOURCE_MEC_CDE,
        TGT.PLAN_YEAR_NR,
        TGT.PLAN_MONTH_NR,
        TGT.AGREEMENT_CUSIP_CDE,
        TGT.AGREEMENT_DIVIDEND_OPTION_CDE,
        TGT.SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
        TGT.APL_CDE,
        TGT.BASE_FACE_RATING_NR,
        TGT.BASE_TEMPORARY_PREMIUM_AMT,
        TGT.BASE_TEMPORARY_DURATION_NR,
        TGT.BASE_PERMANENT_PREMIUM_AMT,
        TGT.BASE_FACE_AMT,
        TGT.ACTIVITY_PENDING_CDE,
        TGT.ACTIVITY_PENDING_DESC,
        TGT.SOURCE_ACTIVITY_PENDING_DESC,
        TGT.APD_IND,
        TGT.SOURCE_APD_IND,
        TGT.APM_NR_TXT,
        TGT.SOURCE_APM_NR_TXT,
        TGT.SOURCE_APL_CDE,
        TGT.CONVERSION_IND,
        TGT.SOURCE_CONVERSION_IND,
        TGT.CONVERTED_POLICY_TYPE_CDE,
        TGT.SOURCE_CONVERTED_POLICY_TYPE_CDE,
        TGT.CONVERTED_POLICY_NR_TXT,
        TGT.ACTIVITY_CDE,
        TGT.DELIVERY_DATA_CDE,
        TGT.SOURCE_DELIVERY_DATA_CDE,
        TGT.BENEFIT_AMT,
        TGT.DEATH_BENEFIT_OPTION_CDE,
        TGT.DEATH_BENEFIT_OPTION_INTEREST_RT,
        TGT.DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
        TGT.exchange_provision_cde,
        TGT.SOURCE_exchange_provision_cde,
        TGT.FREE_LOOK_EXPIRY_DT,
        TGT.INSURANCE_ANNUITY_CDE,
        TGT.SOURCE_INSURANCE_ANNUITY_CDE,
        TGT.LUMP_SUM_BENEFIT_AMT,
        TGT.MEC_EFFECTIVE_DT,
        TGT.MEC_STATUS_CDE,
        TGT.SOURCE_MEC_STATUS_CDE,
        TGT.NON_FORFEITURE_OPTION_CDE,
        TGT.ADMSPEC_CDE,
        TGT.SOURCE_ADMSPEC_CDE,
        TGT.PURPOSE_OF_INSURANCE_CATEGORY_CDE,
        TGT.PURPOSE_OF_INSURANCE_CDE,
        TGT.PEND_SETTLE_CDE,
        TGT.REINSURED_CDE,
        TGT.SOURCE_REINSURED_CDE,
        TGT.TEMPORARY_TERM_PRE_EFFECTIVE_DT,
        TGT.TEMPORARY_TERM_STATUS_CDE,
        TGT.YEARLY_TERM_PURCHASE_CDE,
        TGT.POLICY_LAPSE_DT,
        TGT.DBO_SHORT_NM,
        TGT.MEC_EFFECTIVE_DT_QUALITY_CDE,
        TGT.VLR_RC,
        TGT.TELEPHONE_AUTHORIZATION_CDE,
        TGT.TAX_AGG_CDE,
        TGT.SOURCE_TAX_AGG_CDE,
        TGT.TAX_AMT_NOT_DETERMINED_IND,
        TGT.ASSIGN_DT,
        TGT.EARLIEST_PERMITTED_ANNUITY_DT,
        TGT.LATEST_PERMITTED_ANNUITY_DT,
        TGT.SOURCE_TELEPHONE_AUTHORIZATION_CDE,
        TGT.WITHDRAWAL_OPTION_CDE,
        TGT.SOURCE_WITHDRAWAL_OPTION_CDE,
        TGT.GLWB_STATUS_CDE,
        TGT.SOURCE_GLWB_STATUS_CDE,
        TGT.GLWB_STATUS_DT,
        TGT.REINSURANCE_TREATY_NR_TXT,
        TGT.EXCESS_WITHDRAWAL_CDE,
        TGT.SOURCE_EXCESS_WITHDRAWAL_CDE,
        TGT.VI_RIDER_IND,
        TGT.PORTABILITY_IND,
        TGT.AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        TGT.SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        TGT.AGREEMENT_DIVIDEND_OPTION_DESC,
        TGT.AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
        TGT.SOURCE_DELETE_IND,
        TGT.SOURCE_PRODUCT_TYPE_CDE,
		TGT.PERSISTENCY_CREDIT_CDE,
		TGT.SOURCE_PERSISTENCY_CREDIT_CDE,
		TGT.PERSISTENCY_CREDIT_START_DT,
		TGT.DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
FROM EDW_STAGING.AIFRPS_DIM_AGREEMENT_PRE_WORK SRC
JOIN {{target_schema}}.dim_agreement TGT
ON
SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID = TGT.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID
AND TGT.CURRENT_ROW_IND = TRUE
WHERE SRC.CHECK_SUM <> TGT.CHECK_SUM;

-- Step4 get updated records from source side.
INSERT INTO EDW_WORK.AIFRPS_DIM_AGREEMENT
    (
    DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    MASTER_CONTRACT_GROUP_ID,
    SPONSOR_ID,
    PLAN_ID,
    SUBSCRIBER_ID,
    PARTICIPANT_ID,
    ICU_ID,
    MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC,
    PLAN_NM_1_TXT,
    PLAN_NM_2_TXT,
    PLAN_NM_3_TXT,
    SUBSCRIBER_NR,
    AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    ALLOW_ROLLOVER_IND,
    APPLICATION_SUBMIT_DT,
    BENEFICIARIES_RECORDED_IND,
    CONVERSION_EXPIRED_IND,
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    DEFAULT_VOLUNTARY_DEFERRAL_RT,
    ENROLLMENT_DT,
    ENROLLMENT_ELIGIBILITY_DT,
    ENROLLMENT_START_DT,
    ENROLLMENT_END_DT,
    ENROLLMENT_STATUS_CDE,
    ENROLLMENT_TYPE_CDE,
    FACE_AMT,
    INTERNAL_PLAN_ID,
    ISSUE_DT,
    PARTICIPATION_DT,
    SOLICITATION_DT,
    SOLICITATION_IND,
    TAFT_HARTLY_IND,
    ELECTRONIC_CONTRIBUTION_CHANGE_IND,
    PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
    BEGIN_DT,
    BEGIN_DTM,
    ROW_PROCESS_DTM,
    AUDIT_ID,
    LOGICAL_DELETE_IND,
    CHECK_SUM,
    CURRENT_ROW_IND,
    END_DT,
    END_DTM,
    SOURCE_SYSTEM_ID,
    RESTRICTED_ROW_IND,
    --ROW_SID,
    NEXT_PAYMENT_DT,
    NEXT_PAYMENT_AMT,
    CURRENT_PRINCIPAL_AMT,
    LOAN_BOOKED_COUPON_RT,
    LOAN_BOOKED_AMT,
    LOAN_REQUESTED_COUPON_RT,
    LOAN_REQUESTED_AMT,
    LOAN_MONTHS_TO_MATURITY_VAL,
    LOAN_DEGREE_PROGRAM_DESC,
    DECISIONING_ANNUAL_INCOME_AMT,
    APPLICATION_STATUS_DT,
    LOAN_REPORT_UNIQUE_HASH_ID,
    ESERVICE_IND,
    AGREEMENT_EFFECTIVE_DT,
    UPDATE_AUDIT_ID,
    TERMINATED_PARTICIPANT_SERVICING_IND,
    MANAGED_ACCOUNTS_ELIGIBILITY_IND,
    MANAGED_ACCOUNTS_PARTICIPATION_IND,
	MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
    SOURCE_AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_CATEGORY_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_PLAN_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    SOURCE_READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_AGREEMENT_NR,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    ISSUE_STATE_CDE,
    LAPSE_DT,
    CONVERSION_STATUS_CDE,
    LAST_ANNIVERSARY_DT,
    NEXT_ANNIVERSARY_DT,
    INSURED_ISSUE_AGE_NR,
    SMOKER_CDE,
    MEC_CDE,
    SOURCE_MEC_CDE,
    PLAN_YEAR_NR,
    PLAN_MONTH_NR,
    AGREEMENT_CUSIP_CDE,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    APL_CDE,
    BASE_FACE_RATING_NR,
    BASE_TEMPORARY_PREMIUM_AMT,
    BASE_TEMPORARY_DURATION_NR,
    BASE_PERMANENT_PREMIUM_AMT,
    BASE_FACE_AMT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    exchange_provision_cde,
    SOURCE_exchange_provision_cde,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    SOURCE_DELETE_IND,
    SOURCE_PRODUCT_TYPE_CDE,
	PERSISTENCY_CREDIT_CDE,
	SOURCE_PERSISTENCY_CREDIT_CDE,
	PERSISTENCY_CREDIT_START_DT,
	DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
    )
SELECT
        SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
        SRC.AGREEMENT_NR_PFX,
        SRC.AGREEMENT_NR,
        SRC.AGREEMENT_NR_SFX,
        SRC.AGREEMENT_SOURCE_CDE,
        SRC.AGREEMENT_TYPE_CDE,
        SRC.MASTER_CONTRACT_GROUP_ID,
        SRC.SPONSOR_ID,
        SRC.PLAN_ID,
        SRC.SUBSCRIBER_ID,
        SRC.PARTICIPANT_ID,
        SRC.ICU_ID,
        SRC.MASTER_CONTRACT_GROUP_NM_NATIONAL_DESC,
        SRC.PLAN_NM_1_TXT,
        SRC.PLAN_NM_2_TXT,
        SRC.PLAN_NM_3_TXT,
        SRC.SUBSCRIBER_NR,
        SRC.AGREEMENT_STATUS_CDE,
        SRC.AGREEMENT_STATUS_REASON_CDE,
        SRC.ALLOW_ROLLOVER_IND,
        SRC.APPLICATION_SUBMIT_DT,
        SRC.BENEFICIARIES_RECORDED_IND,
        SRC.CONVERSION_EXPIRED_IND,
        SRC.CONVERSION_ELIGIBILITY_START_DT,
        SRC.CONVERSION_ELIGIBILITY_END_DT,
        SRC.DEFAULT_VOLUNTARY_DEFERRAL_RT,
        SRC.ENROLLMENT_DT,
        SRC.ENROLLMENT_ELIGIBILITY_DT,
        SRC.ENROLLMENT_START_DT,
        SRC.ENROLLMENT_END_DT,
        SRC.ENROLLMENT_STATUS_CDE,
        SRC.ENROLLMENT_TYPE_CDE,
        SRC.FACE_AMT,
        SRC.INTERNAL_PLAN_ID,
        SRC.ISSUE_DT,
        SRC.PARTICIPATION_DT,
        SRC.SOLICITATION_DT,
        SRC.SOLICITATION_IND,
        SRC.TAFT_HARTLY_IND,
        SRC.ELECTRONIC_CONTRIBUTION_CHANGE_IND,
        SRC.PRE_TAX_AUTO_INCREASE_CONTRIBUTION_RT,
        SRC.BEGIN_DT,
        SRC.BEGIN_DTM,
        CURRENT_TIMESTAMP(6) AS ROW_PROCESS_DTM,
        :audit_id AS AUDIT_ID,
        SRC.LOGICAL_DELETE_IND,
        SRC.CHECK_SUM,
        SRC.CURRENT_ROW_IND,
        SRC.END_DT AS END_DT,
        SRC.END_DTM AS END_DTM,
        SRC.SOURCE_SYSTEM_ID,
        SRC.RESTRICTED_ROW_IND,
        --SRC.ROW_SID,
        SRC.NEXT_PAYMENT_DT,
        SRC.NEXT_PAYMENT_AMT,
        SRC.CURRENT_PRINCIPAL_AMT,
        SRC.LOAN_BOOKED_COUPON_RT,
        SRC.LOAN_BOOKED_AMT,
        SRC.LOAN_REQUESTED_COUPON_RT,
        SRC.LOAN_REQUESTED_AMT,
        SRC.LOAN_MONTHS_TO_MATURITY_VAL,
        SRC.LOAN_DEGREE_PROGRAM_DESC,
        SRC.DECISIONING_ANNUAL_INCOME_AMT,
        SRC.APPLICATION_STATUS_DT,
        SRC.LOAN_REPORT_UNIQUE_HASH_ID,
        SRC.ESERVICE_IND,
        SRC.AGREEMENT_EFFECTIVE_DT,
        :audit_id AS UPDATE_AUDIT_ID,
        SRC.TERMINATED_PARTICIPANT_SERVICING_IND,
        SRC.MANAGED_ACCOUNTS_ELIGIBILITY_IND,
        SRC.MANAGED_ACCOUNTS_PARTICIPATION_IND,
		SRC.MANAGED_ACCOUNTS_ELIGIBILITY_START_DTM,
        SRC.SOURCE_AGREEMENT_STATUS_CDE,
        SRC.SOURCE_AGREEMENT_STATUS_REASON_CDE,
        SRC.SOURCE_AGREEMENT_STATUS_CATEGORY_CDE,
        SRC.AGREEMENT_STATUS_DT,
        SRC.DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
        SRC.PT1_KIND_CDE,
        SRC.PT2_ISSUE_BASIS_CDE,
        SRC.PT3_RATE_CDE,
        SRC.MATURITY_DT,
        SRC.ANNIVERSARY_DT,
        SRC.TERMINATION_DT,
        SRC.APPLICATION_RECEIVED_DT,
        SRC.APPLICATION_SIGNED_DT,
        SRC.MARKET_CATEGORY_TYPE_CDE,
        SRC.SOURCE_PLAN_TYPE_CDE,
        SRC.SOURCE_MARKET_CATEGORY_TYPE_CDE,
        SRC.TAX_QUALIFIED_CDE,
        SRC.SOURCE_TAX_QUALIFIED_CDE,
        SRC.REPLACEMENT_TYPE_CDE,
        SRC.SOURCE_REPLACEMENT_TYPE_CDE,
        SRC.RESTRICTION_CDE,
        SRC.SOURCE_RESTRICTION_CDE,
        SRC.RESTRICTION_CATEGORY_CDE,
        SRC.SOURCE_RESTRICTION_CATEGORY_CDE,
        SRC.COMPANY_CDE,
        SRC.SOURCE_COMPANY_CDE,
        SRC.FROZEN_CDE,
        SRC.SOURCE_FROZEN_CDE,
        SRC.HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        SRC.SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        SRC.LOST_INSURED_IND,
        SRC.SOURCE_LOST_INSURED_IND,
        SRC.TITLE_MESSAGE_TXT,
        SRC.OFFER_ACCEPTANCE_CDE,
        SRC.SOURCE_OFFER_ACCEPTANCE_CDE,
        SRC.VARIABLE_PRODUCT_CDE,
        SRC.CONTRACT_JURISDICTION_STATE_CDE,
        SRC.TAX_ACCOUNT_NR,
        SRC.READABILITY_CDE,
        SRC.SOURCE_READABILITY_CDE,
        SRC.VANTAGE_RESTRICTION_CDE,
        SRC.SUSPEND_CDE,
        SRC.SOURCE_SUSPEND_CDE,
        SRC.SOURCE_PRODUCT_SHORT_NM,
        SRC.SOURCE_PRODUCT_LONG_NM,
        SRC.SPECIAL_HANDLING_CDE,
        SRC.SOURCE_SPECIAL_HANDLING_CDE,
        SRC.ISSUE_REASON_CDE,
        SRC.SOURCE_ISSUE_REASON_CDE,
        SRC.CDSC_PERIOD_YEAR_NR,
        SRC.RENEWAL_DT,
        SRC.RETIRE_GUARD_IND,
        SRC.SOURCE_ADMIN_ERROR_CDE,
        SRC.SOURCE_PENDING_ACTIVITY_CDE,
        SRC.SOURCE_AGREEMENT_NR,
        SRC.WORKSITE_IND,
        SRC.PRODUCT_GROUP_CDE,
        SRC.UPDATE_STATE_CDE,
        SRC.AGENCY_SUSPEND_ITEM_CDE,
        SRC.DISTRIBUTOR_CLIENT_ACCOUNT_ID,
        SRC.RESIDENT_STATE_CDE,
        SRC.SOLICITATION_STATE_CDE,
        SRC.DISTRIBUTION_CHANNEL_CDE,
        SRC.SOURCE_DISTRIBUTION_CHANNEL_CDE,
        SRC.PRODUCT_TIER_CDE,
        SRC.REPLACEMENT_CDE,
        SRC.SOURCE_REPLACEMENT_CDE,
        SRC.SPECIAL_CONDITION_CDE,
        SRC.SPECIAL_CONDITION_REASON_CDE,
        SRC.SPECIAL_CONDITION_CATEGORY_CDE,
        SRC.SPECIAL_CONDITION_2_CDE,
        SRC.SPECIAL_CONDITION_2_REASON_CDE,
        SRC.SPECIAL_CONDITION_2_CATEGORY_CDE,
        SRC.SPM_GROUP_BILLED_SUSPENSE_IND,
        SRC.SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
        SRC.SPM_GROUP_AR_SUSPENSE_IND,
        SRC.ACTIVELY_AT_WORK_IND,
        SRC.MARKET_GROUP_CDE,
        SRC.PT_TRANS_TO_INSD_DT,
        SRC.MANAGERIAL_IND,
        SRC.INIT_PD_TO_DT,
        SRC.INSURED_INTERESTED_PARTY_NR_TXT,
        SRC.ISSUE_STATE_CDE,
        SRC.LAPSE_DT,
        SRC.CONVERSION_STATUS_CDE,
        SRC.LAST_ANNIVERSARY_DT,
        SRC.NEXT_ANNIVERSARY_DT,
        SRC.INSURED_ISSUE_AGE_NR,
        SRC.SMOKER_CDE,
        SRC.MEC_CDE,
        SRC.SOURCE_MEC_CDE,
        SRC.PLAN_YEAR_NR,
        SRC.PLAN_MONTH_NR,
        SRC.AGREEMENT_CUSIP_CDE,
        SRC.AGREEMENT_DIVIDEND_OPTION_CDE,
        SRC.SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
        SRC.APL_CDE,
        SRC.BASE_FACE_RATING_NR,
        SRC.BASE_TEMPORARY_PREMIUM_AMT,
        SRC.BASE_TEMPORARY_DURATION_NR,
        SRC.BASE_PERMANENT_PREMIUM_AMT,
        SRC.BASE_FACE_AMT,
        SRC.ACTIVITY_PENDING_CDE,
        SRC.ACTIVITY_PENDING_DESC,
        SRC.SOURCE_ACTIVITY_PENDING_DESC,
        SRC.APD_IND,
        SRC.SOURCE_APD_IND,
        SRC.APM_NR_TXT,
        SRC.SOURCE_APM_NR_TXT,
        SRC.SOURCE_APL_CDE,
        SRC.CONVERSION_IND,
        SRC.SOURCE_CONVERSION_IND,
        SRC.CONVERTED_POLICY_TYPE_CDE,
        SRC.SOURCE_CONVERTED_POLICY_TYPE_CDE,
        SRC.CONVERTED_POLICY_NR_TXT,
        SRC.ACTIVITY_CDE,
        SRC.DELIVERY_DATA_CDE,
        SRC.SOURCE_DELIVERY_DATA_CDE,
        SRC.BENEFIT_AMT,
        SRC.DEATH_BENEFIT_OPTION_CDE,
        SRC.DEATH_BENEFIT_OPTION_INTEREST_RT,
        SRC.DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
        SRC.exchange_provision_cde,
        SRC.SOURCE_exchange_provision_cde,
        SRC.FREE_LOOK_EXPIRY_DT,
        SRC.INSURANCE_ANNUITY_CDE,
        SRC.SOURCE_INSURANCE_ANNUITY_CDE,
        SRC.LUMP_SUM_BENEFIT_AMT,
        SRC.MEC_EFFECTIVE_DT,
        SRC.MEC_STATUS_CDE,
        SRC.SOURCE_MEC_STATUS_CDE,
        SRC.NON_FORFEITURE_OPTION_CDE,
        SRC.ADMSPEC_CDE,
        SRC.SOURCE_ADMSPEC_CDE,
        SRC.PURPOSE_OF_INSURANCE_CATEGORY_CDE,
        SRC.PURPOSE_OF_INSURANCE_CDE,
        SRC.PEND_SETTLE_CDE,
        SRC.REINSURED_CDE,
        SRC.SOURCE_REINSURED_CDE,
        SRC.TEMPORARY_TERM_PRE_EFFECTIVE_DT,
        SRC.TEMPORARY_TERM_STATUS_CDE,
        SRC.YEARLY_TERM_PURCHASE_CDE,
        SRC.POLICY_LAPSE_DT,
        SRC.DBO_SHORT_NM,
        SRC.MEC_EFFECTIVE_DT_QUALITY_CDE,
        SRC.VLR_RC,
        SRC.TELEPHONE_AUTHORIZATION_CDE,
        SRC.TAX_AGG_CDE,
        SRC.SOURCE_TAX_AGG_CDE,
        SRC.TAX_AMT_NOT_DETERMINED_IND,
        SRC.ASSIGN_DT,
        SRC.EARLIEST_PERMITTED_ANNUITY_DT,
        SRC.LATEST_PERMITTED_ANNUITY_DT,
        SRC.SOURCE_TELEPHONE_AUTHORIZATION_CDE,
        SRC.WITHDRAWAL_OPTION_CDE,
        SRC.SOURCE_WITHDRAWAL_OPTION_CDE,
        SRC.GLWB_STATUS_CDE,
        SRC.SOURCE_GLWB_STATUS_CDE,
        SRC.GLWB_STATUS_DT,
        SRC.REINSURANCE_TREATY_NR_TXT,
        SRC.EXCESS_WITHDRAWAL_CDE,
        SRC.SOURCE_EXCESS_WITHDRAWAL_CDE,
        SRC.VI_RIDER_IND,
        SRC.PORTABILITY_IND,
        SRC.AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        SRC.SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        SRC.AGREEMENT_DIVIDEND_OPTION_DESC,
        SRC.AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
        SRC.SOURCE_DELETE_IND,
        SRC.SOURCE_PRODUCT_TYPE_CDE,
		SRC.PERSISTENCY_CREDIT_CDE,
		SRC.SOURCE_PERSISTENCY_CREDIT_CDE,
		SRC.PERSISTENCY_CREDIT_START_DT,
		SRC.DEATH_BENEFIT_OPTION_CHANGE_AGE_NR
FROM EDW_STAGING.AIFRPS_DIM_AGREEMENT_PRE_WORK SRC
LEFT JOIN {{target_schema}}.dim_agreement TGT
ON SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID = TGT.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID
AND TGT.CURRENT_ROW_IND = TRUE
WHERE
(TGT.ROW_SID IS NULL AND SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID
 IN (SELECT DISTINCT DIM_AGREEMENT_NATURAL_KEY_HASH_UUID FROM {{target_schema}}.DIM_AGREEMENT))
OR
(TGT.ROW_SID IS NOT NULL  AND
(SRC.CHECK_SUM <> TGT.CHECK_SUM));