TRUNCATE TABLE EDW_STAGING.AIFRPS_DIM_AGREEMENT_INITIAL_LOAD_PRE_WORK;
TRUNCATE TABLE EDW_WORK.AIFRPS_DIM_AGREEMENT_INITIAL_LOAD;

--Step 1: put data from snapshot to prework

INSERT INTO EDW_STAGING.AIFRPS_DIM_AGREEMENT_INITIAL_LOAD_PRE_WORK
(
    DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    AGREEMENT_EFFECTIVE_DT,
    ISSUE_DT,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    SOURCE_PLAN_TYPE_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SOURCE_READABILITY_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_DELETE_IND,
    SOURCE_AGREEMENT_NR,
    SOURCE_SYSTEM_ID,
    AUDIT_ID,
    UPDATE_AUDIT_ID,
    BEGIN_DT,
    BEGIN_DTM,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    SOURCE_PRODUCT_TYPE_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    LIVING_BENEFIT_NOTICE_CDE,
    SOURCE_LIVING_BENEFIT_NOTICE_CDE,
    LIVING_BENEFIT_LOCK_IN_CDE,
    SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
    LIVING_BENEFIT_LOCK_IN_DT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    APL_CDE,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    CONVERSION_EXPIRED_IND, --add this field, but not include in check-sum
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    FACE_AMT,
    EXCHANGE_PROVISION_CDE,
    SOURCE_EXCHANGE_PROVISION_CDE,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_CDE,
    SOURCE_MEC_CDE,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    CURRENT_ROW_IND,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
    PERSISTENCY_CREDIT_CDE,
    SOURCE_PERSISTENCY_CREDIT_CDE,
    PERSISTENCY_CREDIT_START_DT,
    DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    CHECK_SUM
)
SELECT
    UUID_GEN(
            SRC.AGREEMENT_SOURCE_CDE,
            SRC.AGREEMENT_TYPE_CDE,
            SRC.AGREEMENT_NR_PFX,
            SRC.AGREEMENT_NR,
            SRC.AGREEMENT_NR_SFX
        )::UUID AS DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    AGREEMENT_EFFECTIVE_DT,
    ISSUE_DT,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    SOURCE_PLAN_TYPE_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SOURCE_READABILITY_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_DELETE_IND,
    SOURCE_AGREEMENT_NR,
    SOURCE_SYSTEM_ID,
    AUDIT_ID,
    UPDATE_AUDIT_ID,
    BEGIN_DT,
    BEGIN_DTM,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    SOURCE_PRODUCT_TYPE_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    LIVING_BENEFIT_NOTICE_CDE,
    SOURCE_LIVING_BENEFIT_NOTICE_CDE,
    LIVING_BENEFIT_LOCK_IN_CDE,
    SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
    LIVING_BENEFIT_LOCK_IN_DT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    APL_CDE,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    (CASE WHEN (CONVERSION_ELIGIBILITY_END_DT IS NULL 
		  OR CONVERSION_ELIGIBILITY_END_DT='0001-01-01')
		  THEN NULL
          WHEN CONVERSION_ELIGIBILITY_END_DT > BEGIN_DT THEN 'F'
          ELSE 'T' END )::BOOLEAN AS CONVERSION_EXPIRED_IND,
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    FACE_AMT,
    EXCHANGE_PROVISION_CDE,
    SOURCE_EXCHANGE_PROVISION_CDE,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_CDE,
    SOURCE_MEC_CDE,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    CURRENT_ROW_IND,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
    PERSISTENCY_CREDIT_CDE,
    SOURCE_PERSISTENCY_CREDIT_CDE,
    PERSISTENCY_CREDIT_START_DT,
    DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    UUID_GEN(
            SOURCE_DELETE_IND,
            CLEAN_STRING(AGREEMENT_STATUS_CDE),
            CLEAN_STRING(SOURCE_AGREEMENT_STATUS_CDE),
            CLEAN_STRING(AGREEMENT_STATUS_REASON_CDE),
            CLEAN_STRING(SOURCE_AGREEMENT_STATUS_REASON_CDE),
            AGREEMENT_STATUS_DT,
            DIM_PRODUCT_NATURAL_KEY_HASH_UUID::VARCHAR,
            CLEAN_STRING(PT1_KIND_CDE),
            CLEAN_STRING(PT2_ISSUE_BASIS_CDE),
            CLEAN_STRING(PT3_RATE_CDE),
            AGREEMENT_EFFECTIVE_DT,
            ISSUE_DT,
            MATURITY_DT,
            ANNIVERSARY_DT,
            TERMINATION_DT,
            APPLICATION_RECEIVED_DT,
            APPLICATION_SIGNED_DT,
            CONVERSION_ELIGIBILITY_END_DT,
            CLEAN_STRING(MARKET_CATEGORY_TYPE_CDE),
            CLEAN_STRING(SOURCE_MARKET_CATEGORY_TYPE_CDE),
            CLEAN_STRING(TAX_QUALIFIED_CDE),
            CLEAN_STRING(SOURCE_TAX_QUALIFIED_CDE),
            CLEAN_STRING(SOURCE_PLAN_TYPE_CDE),
            CLEAN_STRING(REPLACEMENT_TYPE_CDE),
            CLEAN_STRING(SOURCE_REPLACEMENT_TYPE_CDE),
            CLEAN_STRING(RESTRICTION_CDE),
            CLEAN_STRING(SOURCE_RESTRICTION_CDE),
            CLEAN_STRING(RESTRICTION_CATEGORY_CDE),
            CLEAN_STRING(SOURCE_RESTRICTION_CATEGORY_CDE),
            CLEAN_STRING(COMPANY_CDE),
            CLEAN_STRING(SOURCE_COMPANY_CDE),
            CLEAN_STRING(FROZEN_CDE),
            CLEAN_STRING(SOURCE_FROZEN_CDE),
            CLEAN_STRING(HOME_OFFICE_AMOUNT_SUSPEND_CDE),
            CLEAN_STRING(SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE),
            LOST_INSURED_IND,
            SOURCE_LOST_INSURED_IND,
            CLEAN_STRING(TITLE_MESSAGE_TXT),
            CLEAN_STRING(OFFER_ACCEPTANCE_CDE),
            CLEAN_STRING(SOURCE_OFFER_ACCEPTANCE_CDE),
            CLEAN_STRING(VARIABLE_PRODUCT_CDE),
            CLEAN_STRING(CONTRACT_JURISDICTION_STATE_CDE),
            CLEAN_STRING(TAX_ACCOUNT_NR),
            CLEAN_STRING(READABILITY_CDE),
            CLEAN_STRING(VANTAGE_RESTRICTION_CDE),
            CLEAN_STRING(SOURCE_READABILITY_CDE),
            CLEAN_STRING(SUSPEND_CDE),
            CLEAN_STRING(SOURCE_SUSPEND_CDE),
            CLEAN_STRING(SOURCE_PRODUCT_SHORT_NM),
            CLEAN_STRING(SOURCE_PRODUCT_LONG_NM),
            CLEAN_STRING(SPECIAL_HANDLING_CDE),
            CLEAN_STRING(SOURCE_SPECIAL_HANDLING_CDE),
            CLEAN_STRING(ISSUE_REASON_CDE),
            CLEAN_STRING(SOURCE_ISSUE_REASON_CDE),
            CDSC_PERIOD_YEAR_NR,
            RENEWAL_DT,
            RETIRE_GUARD_IND,
            CLEAN_STRING(SOURCE_ADMIN_ERROR_CDE),
            CLEAN_STRING(SOURCE_PENDING_ACTIVITY_CDE),
            CLEAN_STRING(SOURCE_AGREEMENT_NR),
            WORKSITE_IND,
            CLEAN_STRING(PRODUCT_GROUP_CDE),
            CLEAN_STRING(UPDATE_STATE_CDE),
            CLEAN_STRING(AGENCY_SUSPEND_ITEM_CDE),
            CLEAN_STRING(SOURCE_PRODUCT_TYPE_CDE),
            CLEAN_STRING(DISTRIBUTOR_CLIENT_ACCOUNT_ID),
            CLEAN_STRING(RESIDENT_STATE_CDE),
            CLEAN_STRING(SOLICITATION_STATE_CDE),
            CLEAN_STRING(DISTRIBUTION_CHANNEL_CDE),
            CLEAN_STRING(SOURCE_DISTRIBUTION_CHANNEL_CDE),
            CLEAN_STRING(PRODUCT_TIER_CDE),
            CLEAN_STRING(REPLACEMENT_CDE),
            CLEAN_STRING(SOURCE_REPLACEMENT_CDE),
            CLEAN_STRING(SPECIAL_CONDITION_CDE),
            CLEAN_STRING(SPECIAL_CONDITION_CATEGORY_CDE),
            CLEAN_STRING(SPECIAL_CONDITION_REASON_CDE),
            CLEAN_STRING(SPECIAL_CONDITION_2_CDE),
            CLEAN_STRING(SPECIAL_CONDITION_2_CATEGORY_CDE),
            CLEAN_STRING(SPECIAL_CONDITION_2_REASON_CDE),
            SPM_GROUP_BILLED_SUSPENSE_IND,
            SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
            SPM_GROUP_AR_SUSPENSE_IND,
            ACTIVELY_AT_WORK_IND,
            CLEAN_STRING(MARKET_GROUP_CDE),
            PT_TRANS_TO_INSD_DT,
            MANAGERIAL_IND,
            INIT_PD_TO_DT,
            CLEAN_STRING(INSURED_INTERESTED_PARTY_NR_TXT),
            CLEAN_STRING(LIVING_BENEFIT_NOTICE_CDE),
            CLEAN_STRING(SOURCE_LIVING_BENEFIT_NOTICE_CDE),
            CLEAN_STRING(LIVING_BENEFIT_LOCK_IN_CDE),
            CLEAN_STRING(SOURCE_LIVING_BENEFIT_LOCK_IN_CDE),
            LIVING_BENEFIT_LOCK_IN_DT,
            CLEAN_STRING(ACTIVITY_PENDING_CDE),
            CLEAN_STRING(ACTIVITY_PENDING_DESC),
            CLEAN_STRING(SOURCE_ACTIVITY_PENDING_DESC),
            APD_IND,
            CLEAN_STRING(SOURCE_APD_IND),
            CLEAN_STRING(APM_NR_TXT),
            CLEAN_STRING(SOURCE_APM_NR_TXT),
            CLEAN_STRING(APL_CDE),
            CLEAN_STRING(SOURCE_APL_CDE),
            CONVERSION_IND,
            CLEAN_STRING(SOURCE_CONVERSION_IND),
            CONVERSION_ELIGIBILITY_START_DT,
            CLEAN_STRING(CONVERTED_POLICY_TYPE_CDE),
            CLEAN_STRING(SOURCE_CONVERTED_POLICY_TYPE_CDE),
            CLEAN_STRING(CONVERTED_POLICY_NR_TXT),
            CLEAN_STRING(ACTIVITY_CDE),
            CLEAN_STRING(DELIVERY_DATA_CDE),
            CLEAN_STRING(SOURCE_DELIVERY_DATA_CDE),
            BENEFIT_AMT,
            CLEAN_STRING(DEATH_BENEFIT_OPTION_CDE),
            DEATH_BENEFIT_OPTION_INTEREST_RT,
            CLEAN_STRING(DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE),
            FACE_AMT,
            CLEAN_STRING(EXCHANGE_PROVISION_CDE),
            CLEAN_STRING(SOURCE_EXCHANGE_PROVISION_CDE),
            FREE_LOOK_EXPIRY_DT,
            CLEAN_STRING(INSURANCE_ANNUITY_CDE),
            CLEAN_STRING(SOURCE_INSURANCE_ANNUITY_CDE),
            LUMP_SUM_BENEFIT_AMT,
            MEC_EFFECTIVE_DT,
            CLEAN_STRING(MEC_CDE),
            CLEAN_STRING(SOURCE_MEC_CDE),
            CLEAN_STRING(MEC_STATUS_CDE),
            CLEAN_STRING(SOURCE_MEC_STATUS_CDE),
            CLEAN_STRING(NON_FORFEITURE_OPTION_CDE),
            CLEAN_STRING(ADMSPEC_CDE),
            CLEAN_STRING(SOURCE_ADMSPEC_CDE),
            CLEAN_STRING(PURPOSE_OF_INSURANCE_CATEGORY_CDE),
            CLEAN_STRING(PURPOSE_OF_INSURANCE_CDE),
            CLEAN_STRING(PEND_SETTLE_CDE),
            CLEAN_STRING(REINSURED_CDE),
            CLEAN_STRING(SOURCE_REINSURED_CDE),
            TEMPORARY_TERM_PRE_EFFECTIVE_DT,
            CLEAN_STRING(TEMPORARY_TERM_STATUS_CDE),
            CLEAN_STRING(YEARLY_TERM_PURCHASE_CDE),
            POLICY_LAPSE_DT,
            CLEAN_STRING(DBO_SHORT_NM),
            CLEAN_STRING(MEC_EFFECTIVE_DT_QUALITY_CDE),
            CLEAN_STRING(VLR_RC),
            CLEAN_STRING(TELEPHONE_AUTHORIZATION_CDE),
            CLEAN_STRING(TAX_AGG_CDE),
            CLEAN_STRING(SOURCE_TAX_AGG_CDE),
            CLEAN_STRING(TAX_AMT_NOT_DETERMINED_IND),
            ASSIGN_DT,
            EARLIEST_PERMITTED_ANNUITY_DT,
            LATEST_PERMITTED_ANNUITY_DT,
            CLEAN_STRING(SOURCE_TELEPHONE_AUTHORIZATION_CDE),
            CLEAN_STRING(WITHDRAWAL_OPTION_CDE),
            CLEAN_STRING(SOURCE_WITHDRAWAL_OPTION_CDE),
            CLEAN_STRING(GLWB_STATUS_CDE),
            CLEAN_STRING(SOURCE_GLWB_STATUS_CDE),
            GLWB_STATUS_DT,
            CLEAN_STRING(REINSURANCE_TREATY_NR_TXT),
            CLEAN_STRING(EXCESS_WITHDRAWAL_CDE),
            CLEAN_STRING(SOURCE_EXCESS_WITHDRAWAL_CDE),
            VI_RIDER_IND,
            PORTABILITY_IND,
            CLEAN_STRING(PERSISTENCY_CREDIT_CDE),
            CLEAN_STRING(SOURCE_PERSISTENCY_CREDIT_CDE),
            PERSISTENCY_CREDIT_START_DT,
            DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
            CLEAN_STRING(AGREEMENT_DIVIDEND_OPTION_CDE),
            CLEAN_STRING(SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE),
            CLEAN_STRING(AGREEMENT_SECOND_DIVIDEND_OPTION_CDE),
            CLEAN_STRING(SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE),
            CLEAN_STRING(AGREEMENT_DIVIDEND_OPTION_DESC),
            CLEAN_STRING(AGREEMENT_SECOND_DIVIDEND_OPTION_DESC)
        )::UUID AS CHECK_SUM


FROM


    (SELECT
         CLEAN_STRING('IPA') AS AGREEMENT_TYPE_CDE,
         UDF_ISNUM_LPAD(AGMT_DATA.HLDG_KEY_PFX, 20, '0', TRUE) AS AGREEMENT_NR_PFX,
         LPAD(AGMT_DATA.HLDG_KEY::VARCHAR, 20, '0') AS AGREEMENT_NR,
         UDF_ISNUM_LPAD(AGMT_DATA.HLDG_KEY_SFX, 20, '0', TRUE) AS AGREEMENT_NR_SFX,
         CLEAN_STRING(AGMT_DATA.CARR_ADMIN_SYS_CD) AS AGREEMENT_SOURCE_CDE,
         CLEAN_STRING(AGMT_DATA.STUS_CD) AS AGREEMENT_STATUS_CDE,
         AGMT_DATA.SRC_STUS_CD AS SOURCE_AGREEMENT_STATUS_CDE,
         CLEAN_STRING(AGMT_DATA.STUS_RSN_CD) AS AGREEMENT_STATUS_REASON_CDE,
         AGMT_DATA.SRC_STUS_RSN_CD AS SOURCE_AGREEMENT_STATUS_REASON_CDE,
         AGMT_DATA.STUS_DT AS AGREEMENT_STATUS_DT,
         UUID_GEN(CLEAN_STRING(AGMT_DATA.PROD_ID))::UUID AS DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
         AGMT_DATA.PROD_TYP_CD_1 AS PT1_KIND_CDE,
         AGMT_DATA.PROD_TYP_CD_2 AS PT2_ISSUE_BASIS_CDE,
         AGMT_DATA.PROD_TYP_CD_3 AS PT3_RATE_CDE,
         AGMT_DATA.CTRT_DT AS AGREEMENT_EFFECTIVE_DT,
         AGMT_DATA.ISS_DT AS ISSUE_DT,
         AGMT_DATA.MATR_DT AS MATURITY_DT,
         AGMT_DATA.ANNV_DT AS ANNIVERSARY_DT,
         AGMT_DATA.TRMN_DT AS TERMINATION_DT,
         AGMT_DATA.APP_RCVD_DT AS APPLICATION_RECEIVED_DT,
         AGMT_DATA.APP_SGND_DT AS APPLICATION_SIGNED_DT,
         AGMT_DATA.CONV_OPT_EXP_DT AS CONVERSION_ELIGIBILITY_END_DT,
         AGMT_DATA.MRKT_TYP_CD AS MARKET_CATEGORY_TYPE_CDE,
         AGMT_DATA.SRC_MRKT_TYP_CD AS SOURCE_MARKET_CATEGORY_TYPE_CDE,
         AGMT_DATA.TAX_QUAL_IND AS TAX_QUALIFIED_CDE,
         AGMT_DATA.SRC_TAX_QUAL_IND AS SOURCE_TAX_QUALIFIED_CDE,
         AGMT_DATA.SRC_PLAN_TYP_CD AS SOURCE_PLAN_TYPE_CDE,
         AGMT_DATA.RPLCMT_TYP_CD AS REPLACEMENT_TYPE_CDE,
         AGMT_DATA.SRC_RPLCMT_TYP_CD AS SOURCE_REPLACEMENT_TYPE_CDE,
         AGMT_DATA.RSTCT_CD AS RESTRICTION_CDE,
         AGMT_DATA.SRC_RSTCT_CD AS SOURCE_RESTRICTION_CDE,
         AGMT_DATA.RSTCT_CTGRY_CD AS RESTRICTION_CATEGORY_CDE,
         AGMT_DATA.SRC_RSTCT_CTGRY_CD AS SOURCE_RESTRICTION_CATEGORY_CDE,
         AGMT_DATA.CO_CD AS COMPANY_CDE,
         AGMT_DATA.SRC_CO_CD AS SOURCE_COMPANY_CDE,
         AGMT_DATA.FRZN_CD AS FROZEN_CDE,
         AGMT_DATA.SRC_FRZN_CD AS SOURCE_FROZEN_CDE,
         AGMT_DATA.HO_AMT_SUSP_IND AS HOME_OFFICE_AMOUNT_SUSPEND_CDE,
         AGMT_DATA.SRC_HO_AMT_SUSP_IND AS SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
         CASE WHEN TRIM(AGMT_DATA.LOST_INSD_IND) = '' THEN NULL ELSE AGMT_DATA.LOST_INSD_IND::BOOLEAN END AS LOST_INSURED_IND,
         AGMT_DATA.SRC_LOST_INSD_IND AS SOURCE_LOST_INSURED_IND,
         AGMT_DATA.TTL_MSG AS TITLE_MESSAGE_TXT,
         AGMT_DATA.OFFR_ACPT_CD AS OFFER_ACCEPTANCE_CDE,
         AGMT_DATA.SRC_OFFR_ACPT_CD AS SOURCE_OFFER_ACCEPTANCE_CDE,
         AGMT_DATA.SRC_VBL_PROD_CD AS VARIABLE_PRODUCT_CDE,
         AGMT_DATA.CTRT_ST AS CONTRACT_JURISDICTION_STATE_CDE,
         AGMT_DATA.TAX_ACCT_NO AS TAX_ACCOUNT_NR,
         AGMT_DATA.READBLTY_CD AS READABILITY_CDE,
         AGMT_DATA.VNTG_RSTCT_IND AS VANTAGE_RESTRICTION_CDE,
         AGMT_DATA.SRC_READABLTY_CD AS SOURCE_READABILITY_CDE,
         AGMT_DATA.SUSPEND_CD AS SUSPEND_CDE,
         AGMT_DATA.SRC_SUSPEND_CD AS SOURCE_SUSPEND_CDE,
         AGMT_DATA.SRC_PROD_SHT_NM AS SOURCE_PRODUCT_SHORT_NM,
         AGMT_DATA.SRC_PROD_LNG_NM AS SOURCE_PRODUCT_LONG_NM,
         AGMT_DATA.SPCL_HNDL_CD AS SPECIAL_HANDLING_CDE,
         AGMT_DATA.SRC_SPCL_HNDL_CD AS SOURCE_SPECIAL_HANDLING_CDE,
         AGMT_DATA.ISS_RSN_CD AS ISSUE_REASON_CDE,
         AGMT_DATA.SRC_ISS_RSN_CD AS SOURCE_ISSUE_REASON_CDE,
         AGMT_DATA.CDSC_PRD_YR AS CDSC_PERIOD_YEAR_NR,
         AGMT_DATA.RNWL_DT AS RENEWAL_DT,
         CASE WHEN TRIM(AGMT_DATA.RTR_GRD_IND) = '' THEN NULL ELSE AGMT_DATA.RTR_GRD_IND::BOOLEAN END AS RETIRE_GUARD_IND,
         AGMT_DATA.SRC_ADMN_ERR_IND AS SOURCE_ADMIN_ERROR_CDE,
         AGMT_DATA.SRC_PEND_ACTV_CD AS SOURCE_PENDING_ACTIVITY_CDE,
         CASE
             WHEN AGMT_DATA.CURRENT_BATCH = TRUE AND UPPER(AGMT_DATA.SRC_DEL_IND) = 'Y'
                 THEN TRUE
             WHEN AGMT_BEN_DATA.CURRENT_BATCH = TRUE AND UPPER(AGMT_BEN_DATA.SRC_DEL_IND) = 'Y'
                 THEN TRUE
             WHEN AGMT_DIVIDEND.CURRENT_BATCH = TRUE AND UPPER(AGMT_DIVIDEND.SRC_DEL_IND) = 'Y'
                 THEN TRUE
             ELSE FALSE
             END  AS SOURCE_DELETE_IND,
         AGMT_DATA.SRC_HLDG_KEY AS SOURCE_AGREEMENT_NR,
         AGMT_DATA.SRC_SYS_ID AS SOURCE_SYSTEM_ID,
         :RUN_ID AS AUDIT_ID,
         :RUN_ID AS UPDATE_AUDIT_ID,
         CASE WHEN AGMT_DATA.CURRENT_BATCH = TRUE
                  THEN AGMT_DATA.TRANS_DT
              WHEN AGMT_BEN_DATA.CURRENT_BATCH = TRUE
                  THEN AGMT_BEN_DATA.TRANS_DT
              WHEN AGMT_DIVIDEND.CURRENT_BATCH = TRUE
                  THEN AGMT_DIVIDEND.TRANS_DT
             END  AS BEGIN_DT,
         CASE WHEN AGMT_DATA.CURRENT_BATCH = TRUE
                  THEN AGMT_DATA.TRANS_DT
              WHEN AGMT_BEN_DATA.CURRENT_BATCH = TRUE
                  THEN AGMT_BEN_DATA.TRANS_DT
              WHEN AGMT_DIVIDEND.CURRENT_BATCH = TRUE
                  THEN AGMT_DIVIDEND.TRANS_DT
             END AS BEGIN_DTM,
         CASE WHEN TRIM(AGMT_DATA.WORKSITE_IND) = '' THEN NULL ELSE AGMT_DATA.WORKSITE_IND::BOOLEAN END AS WORKSITE_IND,
         AGMT_DATA.PROD_GRP_CD AS PRODUCT_GROUP_CDE,
         AGMT_DATA.UPDT_ST_CD AS UPDATE_STATE_CDE,
         AGMT_DATA.HO_AGY_SUSP_IND AS AGENCY_SUSPEND_ITEM_CDE,
         AGMT_DATA.PROD_TYP AS SOURCE_PRODUCT_TYPE_CDE,
         AGMT_DATA.DTRB_CLI_ACCT_ID AS DISTRIBUTOR_CLIENT_ACCOUNT_ID,
         AGMT_DATA.RES_ST AS RESIDENT_STATE_CDE,
         AGMT_DATA.SLCTN_ST AS SOLICITATION_STATE_CDE,
         AGMT_DATA.DTRB_CHNL_CD AS DISTRIBUTION_CHANNEL_CDE,
         AGMT_DATA.SRC_DTRB_CHNL_CD AS SOURCE_DISTRIBUTION_CHANNEL_CDE,
         AGMT_DATA.PROD_TIER_CD AS PRODUCT_TIER_CDE,
         AGMT_DATA.RPLCMT_IND AS REPLACEMENT_CDE,
         AGMT_DATA.SRC_RPLCMT_IND AS SOURCE_REPLACEMENT_CDE,
         AGMT_DATA.SPEC_COND_CDE AS SPECIAL_CONDITION_CDE,
         AGMT_DATA.SPEC_COND_CTGY AS SPECIAL_CONDITION_CATEGORY_CDE,
         AGMT_DATA.SPEC_COND_CDE_RSN AS SPECIAL_CONDITION_REASON_CDE,
         AGMT_DATA.SPEC_COND2_CDE AS SPECIAL_CONDITION_2_CDE,
         AGMT_DATA.SPEC_COND2_CTGY AS SPECIAL_CONDITION_2_CATEGORY_CDE,
         AGMT_DATA.SPEC_COND2_CDE_RSN AS SPECIAL_CONDITION_2_REASON_CDE,
         CASE WHEN TRIM(AGMT_DATA.SPM_GRP_SUSP_IND) = '' THEN NULL ELSE AGMT_DATA.SPM_GRP_SUSP_IND::BOOLEAN END AS SPM_GROUP_BILLED_SUSPENSE_IND, -- ISSUE3 DATA ONLY HAVE '' AND NULL
         CASE WHEN TRIM(AGMT_DATA.SPM_IND_SUSP_IND) = '' THEN NULL ELSE AGMT_DATA.SPM_IND_SUSP_IND::BOOLEAN END AS SPM_INDIVIDUAL_BILLED_SUSPENSE_IND, -- ISSUE3 DATA ONLY HAVE '' AND NULL
         CASE WHEN TRIM(AGMT_DATA.SPM_GRP_AR_SUSP_IND) = '' THEN NULL ELSE AGMT_DATA.SPM_GRP_AR_SUSP_IND::BOOLEAN END AS SPM_GROUP_AR_SUSPENSE_IND, -- ISSUE3 DATA ONLY HAVE '' AND NULL
         CASE WHEN TRIM(AGMT_DATA.ACTVLY_AT_WRK_IND) = '' THEN NULL ELSE AGMT_DATA.ACTVLY_AT_WRK_IND::BOOLEAN END AS ACTIVELY_AT_WORK_IND,
         AGMT_DATA.MRKT_GRP_CD AS MARKET_GROUP_CDE,
         AGMT_DATA.PT_TRANS_TO_INSD_DT AS PT_TRANS_TO_INSD_DT,
         CASE WHEN TRIM(AGMT_DATA.MANAGERIAL_IND) = '' THEN NULL ELSE AGMT_DATA.MANAGERIAL_IND::BOOLEAN END  AS MANAGERIAL_IND,
         AGMT_DATA.INIT_PD_TO_DT AS INIT_PD_TO_DT,
         AGMT_DATA.INSURED_IPN AS INSURED_INTERESTED_PARTY_NR_TXT,
         AGMT_DATA.LIVING_BENE_NOTICE_CD AS LIVING_BENEFIT_NOTICE_CDE,
         AGMT_DATA.SRC_LIVING_BENE_NOTICE_CD AS SOURCE_LIVING_BENEFIT_NOTICE_CDE,
         AGMT_DATA.LOCK_IN_CD AS LIVING_BENEFIT_LOCK_IN_CDE,
         AGMT_DATA.SRC_LOCK_IN_CD AS SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
         AGMT_DATA.AB_IB_LOCK_IN_DT AS LIVING_BENEFIT_LOCK_IN_DT,
         AGMT_BEN_DATA.ACTY_PEND_CD AS ACTIVITY_PENDING_CDE,
         AGMT_BEN_DATA.ACTY_PEND_WD AS ACTIVITY_PENDING_DESC,
         AGMT_BEN_DATA.SRC_ACTY_PEND_WD AS SOURCE_ACTIVITY_PENDING_DESC,
         CASE WHEN TRIM(AGMT_BEN_DATA.APD_IND) = '' THEN NULL ELSE AGMT_BEN_DATA.APD_IND::BOOLEAN END AS APD_IND,
         AGMT_BEN_DATA.SRC_APD_IND AS SOURCE_APD_IND,
         AGMT_BEN_DATA.APM_NBR AS APM_NR_TXT,
         AGMT_BEN_DATA.SRC_APM_NBR AS SOURCE_APM_NR_TXT,
         AGMT_BEN_DATA.APL_IND AS APL_CDE,
         AGMT_BEN_DATA.SRC_APL_IND AS SOURCE_APL_CDE,
         CASE WHEN TRIM(AGMT_BEN_DATA.CONV_IND) = '' THEN NULL ELSE AGMT_BEN_DATA.CONV_IND::BOOLEAN END AS CONVERSION_IND,
         AGMT_BEN_DATA.SRC_CONV_IND AS SOURCE_CONVERSION_IND,
         AGMT_BEN_DATA.CONV_ELIG_STRT_DT AS CONVERSION_ELIGIBILITY_START_DT,
         AGMT_BEN_DATA.CONV_POL_TYP_CD AS CONVERTED_POLICY_TYPE_CDE,
         AGMT_BEN_DATA.SRC_CONV_POL_TYP_CD AS SOURCE_CONVERTED_POLICY_TYPE_CDE,
         AGMT_BEN_DATA.CONV_POL_NBR AS CONVERTED_POLICY_NR_TXT,
         AGMT_BEN_DATA.ACTVY_CD AS ACTIVITY_CDE,
         AGMT_BEN_DATA.DLVRY_DATA_CD AS DELIVERY_DATA_CDE,
         AGMT_BEN_DATA.SRC_DLVRY_DATA_CD AS SOURCE_DELIVERY_DATA_CDE,
         AGMT_BEN_DATA.BEN_AMT AS BENEFIT_AMT,
         AGMT_BEN_DATA.DTH_BEN_OPT_CD AS DEATH_BENEFIT_OPTION_CDE,
         AGMT_BEN_DATA.DTH_BEN_OPT_INT_RT AS DEATH_BENEFIT_OPTION_INTEREST_RT,
         AGMT_BEN_DATA.DTH_BEN_OPT_INT_RT_QLTY_CD AS DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
         AGMT_BEN_DATA.FACE_AMT AS FACE_AMT,
         AGMT_BEN_DATA.HONEYMOON_CD AS EXCHANGE_PROVISION_CDE,
         AGMT_BEN_DATA.SRC_HONEYMOON_CD AS SOURCE_EXCHANGE_PROVISION_CDE,
         AGMT_BEN_DATA.FREE_LOOK_EXP_DT AS FREE_LOOK_EXPIRY_DT,
         AGMT_BEN_DATA.I_A_CD AS INSURANCE_ANNUITY_CDE,
         AGMT_BEN_DATA.SRC_IA_CD AS SOURCE_INSURANCE_ANNUITY_CDE,
         AGMT_BEN_DATA.LUMP_SUM_BEN_AMT AS LUMP_SUM_BENEFIT_AMT,
         AGMT_BEN_DATA.MEC_EFF_DT AS MEC_EFFECTIVE_DT,
         AGMT_BEN_DATA.MEC_IND AS MEC_CDE,
         AGMT_BEN_DATA.SRC_MEC_IND AS SOURCE_MEC_CDE,
         AGMT_BEN_DATA.MEC_STUS_CD AS MEC_STATUS_CDE,
         AGMT_BEN_DATA.SRC_MEC_STUS_CD AS SOURCE_MEC_STATUS_CDE,
         AGMT_BEN_DATA.NON_FORT_OPT_CD AS NON_FORFEITURE_OPTION_CDE,
         AGMT_BEN_DATA.OBJ_ADMSPEC_CD AS ADMSPEC_CDE,
         AGMT_BEN_DATA.SRC_OBJ_ADMSPEC_CD AS SOURCE_ADMSPEC_CDE,
         AGMT_BEN_DATA.PURP_INS_CTGY_CD AS PURPOSE_OF_INSURANCE_CATEGORY_CDE,
         AGMT_BEN_DATA.PURP_INS_CD AS PURPOSE_OF_INSURANCE_CDE,
         AGMT_BEN_DATA.PEND_STTL_IND AS PEND_SETTLE_CDE,
         AGMT_BEN_DATA.REINS_IND AS REINSURED_CDE,
         AGMT_BEN_DATA.SRC_REINS_IND AS SOURCE_REINSURED_CDE,
         AGMT_BEN_DATA.TMP_TRMN_PRE_EFF_DT AS TEMPORARY_TERM_PRE_EFFECTIVE_DT,
         AGMT_BEN_DATA.TMP_TRMN_STUS_CD AS TEMPORARY_TERM_STATUS_CDE,
         AGMT_BEN_DATA.YR_TRMN_PRCH_CD AS YEARLY_TERM_PURCHASE_CDE,
         TRUE AS CURRENT_ROW_IND,
         AGMT_BEN_DATA.LAPSE_CNTL_DT AS POLICY_LAPSE_DT,
         AGMT_BEN_DATA.DBO_SHT_NM AS DBO_SHORT_NM,
         AGMT_BEN_DATA.MEC_EFF_DT_QLTY_CD AS MEC_EFFECTIVE_DT_QUALITY_CDE,
         AGMT_BEN_DATA.VLR_RC AS VLR_RC,
         AGMT_BEN_DATA.TEL_AUTH_IND AS TELEPHONE_AUTHORIZATION_CDE,
         AGMT_BEN_DATA.TAX_AGG_IND AS TAX_AGG_CDE,
         AGMT_BEN_DATA.SRC_TAX_AGG_IND AS SOURCE_TAX_AGG_CDE,
         AGMT_BEN_DATA.TAX_AMT_NOT_DTRMN_IND AS TAX_AMT_NOT_DETERMINED_IND,
         AGMT_BEN_DATA.DATE_OF_ASSIGN AS ASSIGN_DT,
         AGMT_BEN_DATA.ERLY_PERMT_ANN_DT AS EARLIEST_PERMITTED_ANNUITY_DT,
         AGMT_BEN_DATA.LATE_PERMT_ANN_DT AS LATEST_PERMITTED_ANNUITY_DT,
         AGMT_BEN_DATA.SRC_TEL_AUTH_IND AS SOURCE_TELEPHONE_AUTHORIZATION_CDE,
         AGMT_BEN_DATA.WDRWL_OPT_CD AS WITHDRAWAL_OPTION_CDE,
         AGMT_BEN_DATA.SRC_WDRWL_OPT_CD AS SOURCE_WITHDRAWAL_OPTION_CDE,
         AGMT_BEN_DATA.GLWB_STATUS AS GLWB_STATUS_CDE,
         AGMT_BEN_DATA.SRC_GLWB_STATUS AS SOURCE_GLWB_STATUS_CDE,
         AGMT_BEN_DATA.GLWB_STATUS_DT AS GLWB_STATUS_DT,
         AGMT_BEN_DATA.REIN_TREATY_NR AS REINSURANCE_TREATY_NR_TXT,
         AGMT_BEN_DATA.EXCESS_WDRWL_IND AS EXCESS_WITHDRAWAL_CDE,
         AGMT_BEN_DATA.SRC_EXCESS_WDRWL_IND AS SOURCE_EXCESS_WITHDRAWAL_CDE,
         CASE WHEN TRIM(AGMT_BEN_DATA.VI_RIDER_IND) = '' THEN NULL ELSE AGMT_BEN_DATA.VI_RIDER_IND::BOOLEAN END AS VI_RIDER_IND,
         CASE WHEN TRIM(AGMT_BEN_DATA.PORTABILITY_IND) = '' THEN NULL ELSE AGMT_BEN_DATA.PORTABILITY_IND::BOOLEAN END AS PORTABILITY_IND,
         AGMT_BEN_DATA.PERS_CREDIT_IND AS PERSISTENCY_CREDIT_CDE,
         AGMT_BEN_DATA.SRC_PERS_CREDIT_IND AS SOURCE_PERSISTENCY_CREDIT_CDE,
         AGMT_BEN_DATA.PERS_CR_STRT_DT AS PERSISTENCY_CREDIT_START_DT,
         AGMT_BEN_DATA.DTH_BEN_OPT_AGE_CHG AS DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
         AGMT_DIVIDEND.DIVD_OPT_CD AS AGREEMENT_DIVIDEND_OPTION_CDE,
         AGMT_DIVIDEND.SRC_DIVD_OPT_CD AS SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
         AGMT_DIVIDEND.SCND_DIVD_OPT_CD AS AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
         AGMT_DIVIDEND.SRC_SCND_DIVD_OPT_CD AS SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
         AGMT_DIVIDEND.DIVD_OPT_WD AS AGREEMENT_DIVIDEND_OPTION_DESC,
         AGMT_DIVIDEND.SCND_CURR_DIVD_OPT_WD AS AGREEMENT_SECOND_DIVIDEND_OPTION_DESC

     FROM EDW_STAGING.AIFRPS_AGMT_DATA_VW_SNAPSHOT AGMT_DATA
              LEFT JOIN
          EDW_STAGING.AIFRPS_AGMT_BEN_DATA_VW_SNAPSHOT AGMT_BEN_DATA
          ON AGMT_DATA.AGMT_ID = AGMT_BEN_DATA.AGMT_ID
              LEFT JOIN
          EDW_STAGING.AIFRPS_AGMT_DIVIDEND_VW_SNAPSHOT AGMT_DIVIDEND
          ON AGMT_DATA.AGMT_ID = AGMT_DIVIDEND.AGMT_ID
     WHERE AGMT_DATA.CURRENT_BATCH = TRUE OR AGMT_BEN_DATA.CURRENT_BATCH = TRUE OR AGMT_DIVIDEND.CURRENT_BATCH = TRUE) SRC;


--Step 2: insert

INSERT INTO EDW_WORK.AIFRPS_DIM_AGREEMENT_INITIAL_LOAD
(
    DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    AGREEMENT_EFFECTIVE_DT,
    ISSUE_DT,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    SOURCE_PLAN_TYPE_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SOURCE_READABILITY_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_DELETE_IND,
    SOURCE_AGREEMENT_NR,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    SOURCE_PRODUCT_TYPE_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    LIVING_BENEFIT_NOTICE_CDE,
    SOURCE_LIVING_BENEFIT_NOTICE_CDE,
    LIVING_BENEFIT_LOCK_IN_CDE,
    SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
    LIVING_BENEFIT_LOCK_IN_DT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    APL_CDE,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    CONVERSION_EXPIRED_IND,
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    FACE_AMT,
    EXCHANGE_PROVISION_CDE,
    SOURCE_EXCHANGE_PROVISION_CDE,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_CDE,
    SOURCE_MEC_CDE,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
	PERSISTENCY_CREDIT_CDE,
	SOURCE_PERSISTENCY_CREDIT_CDE,
	PERSISTENCY_CREDIT_START_DT,
	DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    BEGIN_DT,
    BEGIN_DTM,
    ROW_PROCESS_DTM,
    AUDIT_ID,
    UPDATE_AUDIT_ID,
    LOGICAL_DELETE_IND,
    CHECK_SUM,
    CURRENT_ROW_IND,
    END_DT,
    END_DTM,
    SOURCE_SYSTEM_ID,
    RESTRICTED_ROW_IND
)
SELECT
    DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    AGREEMENT_NR_PFX,
    AGREEMENT_NR,
    AGREEMENT_NR_SFX,
    AGREEMENT_SOURCE_CDE,
    AGREEMENT_TYPE_CDE,
    AGREEMENT_STATUS_CDE,
    SOURCE_AGREEMENT_STATUS_CDE,
    AGREEMENT_STATUS_REASON_CDE,
    SOURCE_AGREEMENT_STATUS_REASON_CDE,
    AGREEMENT_STATUS_DT,
    DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    PT1_KIND_CDE,
    PT2_ISSUE_BASIS_CDE,
    PT3_RATE_CDE,
    AGREEMENT_EFFECTIVE_DT,
    ISSUE_DT,
    MATURITY_DT,
    ANNIVERSARY_DT,
    TERMINATION_DT,
    APPLICATION_RECEIVED_DT,
    APPLICATION_SIGNED_DT,
    CONVERSION_ELIGIBILITY_END_DT,
    MARKET_CATEGORY_TYPE_CDE,
    SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TAX_QUALIFIED_CDE,
    SOURCE_TAX_QUALIFIED_CDE,
    SOURCE_PLAN_TYPE_CDE,
    REPLACEMENT_TYPE_CDE,
    SOURCE_REPLACEMENT_TYPE_CDE,
    RESTRICTION_CDE,
    SOURCE_RESTRICTION_CDE,
    RESTRICTION_CATEGORY_CDE,
    SOURCE_RESTRICTION_CATEGORY_CDE,
    COMPANY_CDE,
    SOURCE_COMPANY_CDE,
    FROZEN_CDE,
    SOURCE_FROZEN_CDE,
    HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    LOST_INSURED_IND,
    SOURCE_LOST_INSURED_IND,
    TITLE_MESSAGE_TXT,
    OFFER_ACCEPTANCE_CDE,
    SOURCE_OFFER_ACCEPTANCE_CDE,
    VARIABLE_PRODUCT_CDE,
    CONTRACT_JURISDICTION_STATE_CDE,
    TAX_ACCOUNT_NR,
    READABILITY_CDE,
    VANTAGE_RESTRICTION_CDE,
    SOURCE_READABILITY_CDE,
    SUSPEND_CDE,
    SOURCE_SUSPEND_CDE,
    SOURCE_PRODUCT_SHORT_NM,
    SOURCE_PRODUCT_LONG_NM,
    SPECIAL_HANDLING_CDE,
    SOURCE_SPECIAL_HANDLING_CDE,
    ISSUE_REASON_CDE,
    SOURCE_ISSUE_REASON_CDE,
    CDSC_PERIOD_YEAR_NR,
    RENEWAL_DT,
    RETIRE_GUARD_IND,
    SOURCE_ADMIN_ERROR_CDE,
    SOURCE_PENDING_ACTIVITY_CDE,
    SOURCE_DELETE_IND,
    SOURCE_AGREEMENT_NR,
    WORKSITE_IND,
    PRODUCT_GROUP_CDE,
    UPDATE_STATE_CDE,
    AGENCY_SUSPEND_ITEM_CDE,
    SOURCE_PRODUCT_TYPE_CDE,
    DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    RESIDENT_STATE_CDE,
    SOLICITATION_STATE_CDE,
    DISTRIBUTION_CHANNEL_CDE,
    SOURCE_DISTRIBUTION_CHANNEL_CDE,
    PRODUCT_TIER_CDE,
    REPLACEMENT_CDE,
    SOURCE_REPLACEMENT_CDE,
    SPECIAL_CONDITION_CDE,
    SPECIAL_CONDITION_CATEGORY_CDE,
    SPECIAL_CONDITION_REASON_CDE,
    SPECIAL_CONDITION_2_CDE,
    SPECIAL_CONDITION_2_CATEGORY_CDE,
    SPECIAL_CONDITION_2_REASON_CDE,
    SPM_GROUP_BILLED_SUSPENSE_IND,
    SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SPM_GROUP_AR_SUSPENSE_IND,
    ACTIVELY_AT_WORK_IND,
    MARKET_GROUP_CDE,
    PT_TRANS_TO_INSD_DT,
    MANAGERIAL_IND,
    INIT_PD_TO_DT,
    INSURED_INTERESTED_PARTY_NR_TXT,
    LIVING_BENEFIT_NOTICE_CDE,
    SOURCE_LIVING_BENEFIT_NOTICE_CDE,
    LIVING_BENEFIT_LOCK_IN_CDE,
    SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
    LIVING_BENEFIT_LOCK_IN_DT,
    ACTIVITY_PENDING_CDE,
    ACTIVITY_PENDING_DESC,
    SOURCE_ACTIVITY_PENDING_DESC,
    APD_IND,
    SOURCE_APD_IND,
    APM_NR_TXT,
    SOURCE_APM_NR_TXT,
    APL_CDE,
    SOURCE_APL_CDE,
    CONVERSION_IND,
    SOURCE_CONVERSION_IND,
    CONVERSION_EXPIRED_IND,
    CONVERSION_ELIGIBILITY_START_DT,
    CONVERTED_POLICY_TYPE_CDE,
    SOURCE_CONVERTED_POLICY_TYPE_CDE,
    CONVERTED_POLICY_NR_TXT,
    ACTIVITY_CDE,
    DELIVERY_DATA_CDE,
    SOURCE_DELIVERY_DATA_CDE,
    BENEFIT_AMT,
    DEATH_BENEFIT_OPTION_CDE,
    DEATH_BENEFIT_OPTION_INTEREST_RT,
    DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    FACE_AMT,
    EXCHANGE_PROVISION_CDE,
    SOURCE_EXCHANGE_PROVISION_CDE,
    FREE_LOOK_EXPIRY_DT,
    INSURANCE_ANNUITY_CDE,
    SOURCE_INSURANCE_ANNUITY_CDE,
    LUMP_SUM_BENEFIT_AMT,
    MEC_EFFECTIVE_DT,
    MEC_CDE,
    SOURCE_MEC_CDE,
    MEC_STATUS_CDE,
    SOURCE_MEC_STATUS_CDE,
    NON_FORFEITURE_OPTION_CDE,
    ADMSPEC_CDE,
    SOURCE_ADMSPEC_CDE,
    PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    PURPOSE_OF_INSURANCE_CDE,
    PEND_SETTLE_CDE,
    REINSURED_CDE,
    SOURCE_REINSURED_CDE,
    TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TEMPORARY_TERM_STATUS_CDE,
    YEARLY_TERM_PURCHASE_CDE,
    POLICY_LAPSE_DT,
    DBO_SHORT_NM,
    MEC_EFFECTIVE_DT_QUALITY_CDE,
    VLR_RC,
    TELEPHONE_AUTHORIZATION_CDE,
    TAX_AGG_CDE,
    SOURCE_TAX_AGG_CDE,
    TAX_AMT_NOT_DETERMINED_IND,
    ASSIGN_DT,
    EARLIEST_PERMITTED_ANNUITY_DT,
    LATEST_PERMITTED_ANNUITY_DT,
    SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    WITHDRAWAL_OPTION_CDE,
    SOURCE_WITHDRAWAL_OPTION_CDE,
    GLWB_STATUS_CDE,
    SOURCE_GLWB_STATUS_CDE,
    GLWB_STATUS_DT,
    REINSURANCE_TREATY_NR_TXT,
    EXCESS_WITHDRAWAL_CDE,
    SOURCE_EXCESS_WITHDRAWAL_CDE,
    VI_RIDER_IND,
    PORTABILITY_IND,
	PERSISTENCY_CREDIT_CDE,
	SOURCE_PERSISTENCY_CREDIT_CDE,
	PERSISTENCY_CREDIT_START_DT,
	DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
    AGREEMENT_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    AGREEMENT_DIVIDEND_OPTION_DESC,
    AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    BEGIN_DT,
    BEGIN_DTM,
    CURRENT_TIMESTAMP(6) AS ROW_PROCESS_DTM,
    :RUN_ID AS AUDIT_ID,
    :RUN_ID AS UPDATE_AUDIT_ID,
    FALSE AS LOGICAL_DELETE_IND,
    CHECK_SUM AS CHECK_SUM,
    TRUE AS CURRENT_ROW_IND,
    '9999-12-31'::DATE AS END_DT,
    '9999-12-31'::TIMESTAMP  AS END_DTM,
    266 AS SOURCE_SYSTEM_ID,
    FALSE AS RESTRICTED_ROW_IND
FROM EDW_STAGING.AIFRPS_DIM_AGREEMENT_INITIAL_LOAD_PRE_WORK SRC
WHERE SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID NOT IN
      (SELECT DISTINCT DIM_AGREEMENT_NATURAL_KEY_HASH_UUID FROM EDW_TDSUNSET.DIM_AGREEMENT_INITIAL_AIF_RPS
       WHERE /*SOURCE_SYSTEM_ID = 266 AND*/ LOGICAL_DELETE_IND = FALSE );

--Step 3: Updated record from Target table
INSERT INTO EDW_WORK.AIFRPS_DIM_AGREEMENT_INITIAL_LOAD
    (
        DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
        AGREEMENT_NR_PFX,
        AGREEMENT_NR,
        AGREEMENT_NR_SFX,
        AGREEMENT_SOURCE_CDE,
        AGREEMENT_TYPE_CDE,
        AGREEMENT_STATUS_CDE,
        SOURCE_AGREEMENT_STATUS_CDE,
        AGREEMENT_STATUS_REASON_CDE,
        SOURCE_AGREEMENT_STATUS_REASON_CDE,
        AGREEMENT_STATUS_DT,
        DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
        PT1_KIND_CDE,
        PT2_ISSUE_BASIS_CDE,
        PT3_RATE_CDE,
        AGREEMENT_EFFECTIVE_DT,
        ISSUE_DT,
        MATURITY_DT,
        ANNIVERSARY_DT,
        TERMINATION_DT,
        APPLICATION_RECEIVED_DT,
        APPLICATION_SIGNED_DT,
        CONVERSION_ELIGIBILITY_END_DT,
        MARKET_CATEGORY_TYPE_CDE,
        SOURCE_MARKET_CATEGORY_TYPE_CDE,
        TAX_QUALIFIED_CDE,
        SOURCE_TAX_QUALIFIED_CDE,
        SOURCE_PLAN_TYPE_CDE,
        REPLACEMENT_TYPE_CDE,
        SOURCE_REPLACEMENT_TYPE_CDE,
        RESTRICTION_CDE,
        SOURCE_RESTRICTION_CDE,
        RESTRICTION_CATEGORY_CDE,
        SOURCE_RESTRICTION_CATEGORY_CDE,
        COMPANY_CDE,
        SOURCE_COMPANY_CDE,
        FROZEN_CDE,
        SOURCE_FROZEN_CDE,
        HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        LOST_INSURED_IND,
        SOURCE_LOST_INSURED_IND,
        TITLE_MESSAGE_TXT,
        OFFER_ACCEPTANCE_CDE,
        SOURCE_OFFER_ACCEPTANCE_CDE,
        VARIABLE_PRODUCT_CDE,
        CONTRACT_JURISDICTION_STATE_CDE,
        TAX_ACCOUNT_NR,
        READABILITY_CDE,
        VANTAGE_RESTRICTION_CDE,
        SOURCE_READABILITY_CDE,
        SUSPEND_CDE,
        SOURCE_SUSPEND_CDE,
        SOURCE_PRODUCT_SHORT_NM,
        SOURCE_PRODUCT_LONG_NM,
        SPECIAL_HANDLING_CDE,
        SOURCE_SPECIAL_HANDLING_CDE,
        ISSUE_REASON_CDE,
        SOURCE_ISSUE_REASON_CDE,
        CDSC_PERIOD_YEAR_NR,
        RENEWAL_DT,
        RETIRE_GUARD_IND,
        SOURCE_ADMIN_ERROR_CDE,
        SOURCE_PENDING_ACTIVITY_CDE,
        SOURCE_DELETE_IND,
        SOURCE_AGREEMENT_NR,
        WORKSITE_IND,
        PRODUCT_GROUP_CDE,
        UPDATE_STATE_CDE,
        AGENCY_SUSPEND_ITEM_CDE,
        SOURCE_PRODUCT_TYPE_CDE,
        DISTRIBUTOR_CLIENT_ACCOUNT_ID,
        RESIDENT_STATE_CDE,
        SOLICITATION_STATE_CDE,
        DISTRIBUTION_CHANNEL_CDE,
        SOURCE_DISTRIBUTION_CHANNEL_CDE,
        PRODUCT_TIER_CDE,
        REPLACEMENT_CDE,
        SOURCE_REPLACEMENT_CDE,
        SPECIAL_CONDITION_CDE,
        SPECIAL_CONDITION_CATEGORY_CDE,
        SPECIAL_CONDITION_REASON_CDE,
        SPECIAL_CONDITION_2_CDE,
        SPECIAL_CONDITION_2_CATEGORY_CDE,
        SPECIAL_CONDITION_2_REASON_CDE,
        SPM_GROUP_BILLED_SUSPENSE_IND,
        SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
        SPM_GROUP_AR_SUSPENSE_IND,
        ACTIVELY_AT_WORK_IND,
        MARKET_GROUP_CDE,
        PT_TRANS_TO_INSD_DT,
        MANAGERIAL_IND,
        INIT_PD_TO_DT,
        INSURED_INTERESTED_PARTY_NR_TXT,
        LIVING_BENEFIT_NOTICE_CDE,
        SOURCE_LIVING_BENEFIT_NOTICE_CDE,
        LIVING_BENEFIT_LOCK_IN_CDE,
        SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
        LIVING_BENEFIT_LOCK_IN_DT,
        ACTIVITY_PENDING_CDE,
        ACTIVITY_PENDING_DESC,
        SOURCE_ACTIVITY_PENDING_DESC,
        APD_IND,
        SOURCE_APD_IND,
        APM_NR_TXT,
        SOURCE_APM_NR_TXT,
        APL_CDE,
        SOURCE_APL_CDE,
        CONVERSION_IND,
        SOURCE_CONVERSION_IND,
        CONVERSION_EXPIRED_IND,
        CONVERSION_ELIGIBILITY_START_DT,
        CONVERTED_POLICY_TYPE_CDE,
        SOURCE_CONVERTED_POLICY_TYPE_CDE,
        CONVERTED_POLICY_NR_TXT,
        ACTIVITY_CDE,
        DELIVERY_DATA_CDE,
        SOURCE_DELIVERY_DATA_CDE,
        BENEFIT_AMT,
        DEATH_BENEFIT_OPTION_CDE,
        DEATH_BENEFIT_OPTION_INTEREST_RT,
        DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
        FACE_AMT,
        EXCHANGE_PROVISION_CDE,
        SOURCE_EXCHANGE_PROVISION_CDE,
        FREE_LOOK_EXPIRY_DT,
        INSURANCE_ANNUITY_CDE,
        SOURCE_INSURANCE_ANNUITY_CDE,
        LUMP_SUM_BENEFIT_AMT,
        MEC_EFFECTIVE_DT,
        MEC_CDE,
        SOURCE_MEC_CDE,
        MEC_STATUS_CDE,
        SOURCE_MEC_STATUS_CDE,
        NON_FORFEITURE_OPTION_CDE,
        ADMSPEC_CDE,
        SOURCE_ADMSPEC_CDE,
        PURPOSE_OF_INSURANCE_CATEGORY_CDE,
        PURPOSE_OF_INSURANCE_CDE,
        PEND_SETTLE_CDE,
        REINSURED_CDE,
        SOURCE_REINSURED_CDE,
        TEMPORARY_TERM_PRE_EFFECTIVE_DT,
        TEMPORARY_TERM_STATUS_CDE,
        YEARLY_TERM_PURCHASE_CDE,
        POLICY_LAPSE_DT,
        DBO_SHORT_NM,
        MEC_EFFECTIVE_DT_QUALITY_CDE,
        VLR_RC,
        TELEPHONE_AUTHORIZATION_CDE,
        TAX_AGG_CDE,
        SOURCE_TAX_AGG_CDE,
        TAX_AMT_NOT_DETERMINED_IND,
        ASSIGN_DT,
        EARLIEST_PERMITTED_ANNUITY_DT,
        LATEST_PERMITTED_ANNUITY_DT,
        SOURCE_TELEPHONE_AUTHORIZATION_CDE,
        WITHDRAWAL_OPTION_CDE,
        SOURCE_WITHDRAWAL_OPTION_CDE,
        GLWB_STATUS_CDE,
        SOURCE_GLWB_STATUS_CDE,
        GLWB_STATUS_DT,
        REINSURANCE_TREATY_NR_TXT,
        EXCESS_WITHDRAWAL_CDE,
        SOURCE_EXCESS_WITHDRAWAL_CDE,
        VI_RIDER_IND,
        PORTABILITY_IND,
		PERSISTENCY_CREDIT_CDE,
		SOURCE_PERSISTENCY_CREDIT_CDE,
		PERSISTENCY_CREDIT_START_DT,
		DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
        AGREEMENT_DIVIDEND_OPTION_CDE,
        SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
        AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        AGREEMENT_DIVIDEND_OPTION_DESC,
        AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
        BEGIN_DT,
        BEGIN_DTM,
        ROW_PROCESS_DTM,
        AUDIT_ID,
        UPDATE_AUDIT_ID,
        LOGICAL_DELETE_IND,
        CHECK_SUM,
        CURRENT_ROW_IND,
        END_DT,
        END_DTM,
        SOURCE_SYSTEM_ID,
        RESTRICTED_ROW_IND
    )
SELECT
    TGT.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    TGT.AGREEMENT_NR_PFX,
    TGT.AGREEMENT_NR,
    TGT.AGREEMENT_NR_SFX,
    TGT.AGREEMENT_SOURCE_CDE,
    TGT.AGREEMENT_TYPE_CDE,
    TGT.AGREEMENT_STATUS_CDE,
    TGT.SOURCE_AGREEMENT_STATUS_CDE,
    TGT.AGREEMENT_STATUS_REASON_CDE,
    TGT.SOURCE_AGREEMENT_STATUS_REASON_CDE,
    TGT.AGREEMENT_STATUS_DT,
    TGT.DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    TGT.PT1_KIND_CDE,
    TGT.PT2_ISSUE_BASIS_CDE,
    TGT.PT3_RATE_CDE,
    TGT.AGREEMENT_EFFECTIVE_DT,
    TGT.ISSUE_DT,
    TGT.MATURITY_DT,
    TGT.ANNIVERSARY_DT,
    TGT.TERMINATION_DT,
    TGT.APPLICATION_RECEIVED_DT,
    TGT.APPLICATION_SIGNED_DT,
    TGT.CONVERSION_ELIGIBILITY_END_DT,
    TGT.MARKET_CATEGORY_TYPE_CDE,
    TGT.SOURCE_MARKET_CATEGORY_TYPE_CDE,
    TGT.TAX_QUALIFIED_CDE,
    TGT.SOURCE_TAX_QUALIFIED_CDE,
    TGT.SOURCE_PLAN_TYPE_CDE,
    TGT.REPLACEMENT_TYPE_CDE,
    TGT.SOURCE_REPLACEMENT_TYPE_CDE,
    TGT.RESTRICTION_CDE,
    TGT.SOURCE_RESTRICTION_CDE,
    TGT.RESTRICTION_CATEGORY_CDE,
    TGT.SOURCE_RESTRICTION_CATEGORY_CDE,
    TGT.COMPANY_CDE,
    TGT.SOURCE_COMPANY_CDE,
    TGT.FROZEN_CDE,
    TGT.SOURCE_FROZEN_CDE,
    TGT.HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    TGT.SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    TGT.LOST_INSURED_IND,
    TGT.SOURCE_LOST_INSURED_IND,
    TGT.TITLE_MESSAGE_TXT,
    TGT.OFFER_ACCEPTANCE_CDE,
    TGT.SOURCE_OFFER_ACCEPTANCE_CDE,
    TGT.VARIABLE_PRODUCT_CDE,
    TGT.CONTRACT_JURISDICTION_STATE_CDE,
    TGT.TAX_ACCOUNT_NR,
    TGT.READABILITY_CDE,
    TGT.VANTAGE_RESTRICTION_CDE,
    TGT.SOURCE_READABILITY_CDE,
    TGT.SUSPEND_CDE,
    TGT.SOURCE_SUSPEND_CDE,
    TGT.SOURCE_PRODUCT_SHORT_NM,
    TGT.SOURCE_PRODUCT_LONG_NM,
    TGT.SPECIAL_HANDLING_CDE,
    TGT.SOURCE_SPECIAL_HANDLING_CDE,
    TGT.ISSUE_REASON_CDE,
    TGT.SOURCE_ISSUE_REASON_CDE,
    TGT.CDSC_PERIOD_YEAR_NR,
    TGT.RENEWAL_DT,
    TGT.RETIRE_GUARD_IND,
    TGT.SOURCE_ADMIN_ERROR_CDE,
    TGT.SOURCE_PENDING_ACTIVITY_CDE,
    TGT.SOURCE_DELETE_IND,
    TGT.SOURCE_AGREEMENT_NR,
    TGT.WORKSITE_IND,
    TGT.PRODUCT_GROUP_CDE,
    TGT.UPDATE_STATE_CDE,
    TGT.AGENCY_SUSPEND_ITEM_CDE,
    TGT.SOURCE_PRODUCT_TYPE_CDE,
    TGT.DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    TGT.RESIDENT_STATE_CDE,
    TGT.SOLICITATION_STATE_CDE,
    TGT.DISTRIBUTION_CHANNEL_CDE,
    TGT.SOURCE_DISTRIBUTION_CHANNEL_CDE,
    TGT.PRODUCT_TIER_CDE,
    TGT.REPLACEMENT_CDE,
    TGT.SOURCE_REPLACEMENT_CDE,
    TGT.SPECIAL_CONDITION_CDE,
    TGT.SPECIAL_CONDITION_CATEGORY_CDE,
    TGT.SPECIAL_CONDITION_REASON_CDE,
    TGT.SPECIAL_CONDITION_2_CDE,
    TGT.SPECIAL_CONDITION_2_CATEGORY_CDE,
    TGT.SPECIAL_CONDITION_2_REASON_CDE,
    TGT.SPM_GROUP_BILLED_SUSPENSE_IND,
    TGT.SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    TGT.SPM_GROUP_AR_SUSPENSE_IND,
    TGT.ACTIVELY_AT_WORK_IND,
    TGT.MARKET_GROUP_CDE,
    TGT.PT_TRANS_TO_INSD_DT,
    TGT.MANAGERIAL_IND,
    TGT.INIT_PD_TO_DT,
    TGT.INSURED_INTERESTED_PARTY_NR_TXT,
    TGT.LIVING_BENEFIT_NOTICE_CDE,
    TGT.SOURCE_LIVING_BENEFIT_NOTICE_CDE,
    TGT.LIVING_BENEFIT_LOCK_IN_CDE,
    TGT.SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
    TGT.LIVING_BENEFIT_LOCK_IN_DT,
    TGT.ACTIVITY_PENDING_CDE,
    TGT.ACTIVITY_PENDING_DESC,
    TGT.SOURCE_ACTIVITY_PENDING_DESC,
    TGT.APD_IND,
    TGT.SOURCE_APD_IND,
    TGT.APM_NR_TXT,
    TGT.SOURCE_APM_NR_TXT,
    TGT.APL_CDE,
    TGT.SOURCE_APL_CDE,
    TGT.CONVERSION_IND,
    TGT.SOURCE_CONVERSION_IND,
    TGT.CONVERSION_EXPIRED_IND,
    TGT.CONVERSION_ELIGIBILITY_START_DT,
    TGT.CONVERTED_POLICY_TYPE_CDE,
    TGT.SOURCE_CONVERTED_POLICY_TYPE_CDE,
    TGT.CONVERTED_POLICY_NR_TXT,
    TGT.ACTIVITY_CDE,
    TGT.DELIVERY_DATA_CDE,
    TGT.SOURCE_DELIVERY_DATA_CDE,
    TGT.BENEFIT_AMT,
    TGT.DEATH_BENEFIT_OPTION_CDE,
    TGT.DEATH_BENEFIT_OPTION_INTEREST_RT,
    TGT.DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    TGT.FACE_AMT,
    TGT.EXCHANGE_PROVISION_CDE,
    TGT.SOURCE_EXCHANGE_PROVISION_CDE,
    TGT.FREE_LOOK_EXPIRY_DT,
    TGT.INSURANCE_ANNUITY_CDE,
    TGT.SOURCE_INSURANCE_ANNUITY_CDE,
    TGT.LUMP_SUM_BENEFIT_AMT,
    TGT.MEC_EFFECTIVE_DT,
    TGT.MEC_CDE,
    TGT.SOURCE_MEC_CDE,
    TGT.MEC_STATUS_CDE,
    TGT.SOURCE_MEC_STATUS_CDE,
    TGT.NON_FORFEITURE_OPTION_CDE,
    TGT.ADMSPEC_CDE,
    TGT.SOURCE_ADMSPEC_CDE,
    TGT.PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    TGT.PURPOSE_OF_INSURANCE_CDE,
    TGT.PEND_SETTLE_CDE,
    TGT.REINSURED_CDE,
    TGT.SOURCE_REINSURED_CDE,
    TGT.TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    TGT.TEMPORARY_TERM_STATUS_CDE,
    TGT.YEARLY_TERM_PURCHASE_CDE,
    TGT.POLICY_LAPSE_DT,
    TGT.DBO_SHORT_NM,
    TGT.MEC_EFFECTIVE_DT_QUALITY_CDE,
    TGT.VLR_RC,
    TGT.TELEPHONE_AUTHORIZATION_CDE,
    TGT.TAX_AGG_CDE,
    TGT.SOURCE_TAX_AGG_CDE,
    TGT.TAX_AMT_NOT_DETERMINED_IND,
    TGT.ASSIGN_DT,
    TGT.EARLIEST_PERMITTED_ANNUITY_DT,
    TGT.LATEST_PERMITTED_ANNUITY_DT,
    TGT.SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    TGT.WITHDRAWAL_OPTION_CDE,
    TGT.SOURCE_WITHDRAWAL_OPTION_CDE,
    TGT.GLWB_STATUS_CDE,
    TGT.SOURCE_GLWB_STATUS_CDE,
    TGT.GLWB_STATUS_DT,
    TGT.REINSURANCE_TREATY_NR_TXT,
    TGT.EXCESS_WITHDRAWAL_CDE,
    TGT.SOURCE_EXCESS_WITHDRAWAL_CDE,
    TGT.VI_RIDER_IND,
    TGT.PORTABILITY_IND,
	TGT.PERSISTENCY_CREDIT_CDE,
	TGT.SOURCE_PERSISTENCY_CREDIT_CDE,
	TGT.PERSISTENCY_CREDIT_START_DT,
	TGT.DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
	TGT.AGREEMENT_DIVIDEND_OPTION_CDE,
    TGT.SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    TGT.AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    TGT.SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    TGT.AGREEMENT_DIVIDEND_OPTION_DESC,
    TGT.AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    TGT.BEGIN_DT AS BEGIN_DT,
    TGT.BEGIN_DT AS BEGIN_DTM,
    CURRENT_TIMESTAMP(6) AS ROW_PROCESS_DTM,
    TGT.AUDIT_ID AS AUDIT_ID,
    :RUN_ID AS UPDATE_AUDIT_ID,
    FALSE AS LOGICAL_DELETE_IND,
    TGT.CHECK_SUM AS CHECK_SUM,
    FALSE AS CURRENT_ROW_IND,
    SRC.BEGIN_DT::DATE - INTERVAL '1' DAY AS END_DT,
    SRC.BEGIN_DT::TIMESTAMP  - INTERVAL '1' SECOND AS END_DTM,
    TGT.SOURCE_SYSTEM_ID,
    FALSE AS RESTRICTED_ROW_IND
FROM EDW_STAGING.AIFRPS_DIM_AGREEMENT_INITIAL_LOAD_PRE_WORK SRC
JOIN EDW_TDSUNSET.DIM_AGREEMENT_INITIAL_AIF_RPS  TGT
ON
SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID = TGT.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID
AND TGT.CURRENT_ROW_IND = TRUE /*AND TGT.SOURCE_SYSTEM_ID = 266*/
WHERE
SRC.CHECK_SUM <> TGT.CHECK_SUM;

--Step 4: Updated records from source side
INSERT INTO EDW_WORK.AIFRPS_DIM_AGREEMENT_INITIAL_LOAD
    (
        DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
        AGREEMENT_NR_PFX,
        AGREEMENT_NR,
        AGREEMENT_NR_SFX,
        AGREEMENT_SOURCE_CDE,
        AGREEMENT_TYPE_CDE,
        AGREEMENT_STATUS_CDE,
        SOURCE_AGREEMENT_STATUS_CDE,
        AGREEMENT_STATUS_REASON_CDE,
        SOURCE_AGREEMENT_STATUS_REASON_CDE,
        AGREEMENT_STATUS_DT,
        DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
        PT1_KIND_CDE,
        PT2_ISSUE_BASIS_CDE,
        PT3_RATE_CDE,
        AGREEMENT_EFFECTIVE_DT,
        ISSUE_DT,
        MATURITY_DT,
        ANNIVERSARY_DT,
        TERMINATION_DT,
        APPLICATION_RECEIVED_DT,
        APPLICATION_SIGNED_DT,
        CONVERSION_ELIGIBILITY_END_DT,
        MARKET_CATEGORY_TYPE_CDE,
        SOURCE_MARKET_CATEGORY_TYPE_CDE,
        TAX_QUALIFIED_CDE,
        SOURCE_TAX_QUALIFIED_CDE,
        SOURCE_PLAN_TYPE_CDE,
        REPLACEMENT_TYPE_CDE,
        SOURCE_REPLACEMENT_TYPE_CDE,
        RESTRICTION_CDE,
        SOURCE_RESTRICTION_CDE,
        RESTRICTION_CATEGORY_CDE,
        SOURCE_RESTRICTION_CATEGORY_CDE,
        COMPANY_CDE,
        SOURCE_COMPANY_CDE,
        FROZEN_CDE,
        SOURCE_FROZEN_CDE,
        HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
        LOST_INSURED_IND,
        SOURCE_LOST_INSURED_IND,
        TITLE_MESSAGE_TXT,
        OFFER_ACCEPTANCE_CDE,
        SOURCE_OFFER_ACCEPTANCE_CDE,
        VARIABLE_PRODUCT_CDE,
        CONTRACT_JURISDICTION_STATE_CDE,
        TAX_ACCOUNT_NR,
        READABILITY_CDE,
        VANTAGE_RESTRICTION_CDE,
        SOURCE_READABILITY_CDE,
        SUSPEND_CDE,
        SOURCE_SUSPEND_CDE,
        SOURCE_PRODUCT_SHORT_NM,
        SOURCE_PRODUCT_LONG_NM,
        SPECIAL_HANDLING_CDE,
        SOURCE_SPECIAL_HANDLING_CDE,
        ISSUE_REASON_CDE,
        SOURCE_ISSUE_REASON_CDE,
        CDSC_PERIOD_YEAR_NR,
        RENEWAL_DT,
        RETIRE_GUARD_IND,
        SOURCE_ADMIN_ERROR_CDE,
        SOURCE_PENDING_ACTIVITY_CDE,
        SOURCE_DELETE_IND,
        SOURCE_AGREEMENT_NR,
        WORKSITE_IND,
        PRODUCT_GROUP_CDE,
        UPDATE_STATE_CDE,
        AGENCY_SUSPEND_ITEM_CDE,
        SOURCE_PRODUCT_TYPE_CDE,
        DISTRIBUTOR_CLIENT_ACCOUNT_ID,
        RESIDENT_STATE_CDE,
        SOLICITATION_STATE_CDE,
        DISTRIBUTION_CHANNEL_CDE,
        SOURCE_DISTRIBUTION_CHANNEL_CDE,
        PRODUCT_TIER_CDE,
        REPLACEMENT_CDE,
        SOURCE_REPLACEMENT_CDE,
        SPECIAL_CONDITION_CDE,
        SPECIAL_CONDITION_CATEGORY_CDE,
        SPECIAL_CONDITION_REASON_CDE,
        SPECIAL_CONDITION_2_CDE,
        SPECIAL_CONDITION_2_CATEGORY_CDE,
        SPECIAL_CONDITION_2_REASON_CDE,
        SPM_GROUP_BILLED_SUSPENSE_IND,
        SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
        SPM_GROUP_AR_SUSPENSE_IND,
        ACTIVELY_AT_WORK_IND,
        MARKET_GROUP_CDE,
        PT_TRANS_TO_INSD_DT,
        MANAGERIAL_IND,
        INIT_PD_TO_DT,
        INSURED_INTERESTED_PARTY_NR_TXT,
        LIVING_BENEFIT_NOTICE_CDE,
        SOURCE_LIVING_BENEFIT_NOTICE_CDE,
        LIVING_BENEFIT_LOCK_IN_CDE,
        SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
        LIVING_BENEFIT_LOCK_IN_DT,
        ACTIVITY_PENDING_CDE,
        ACTIVITY_PENDING_DESC,
        SOURCE_ACTIVITY_PENDING_DESC,
        APD_IND,
        SOURCE_APD_IND,
        APM_NR_TXT,
        SOURCE_APM_NR_TXT,
        APL_CDE,
        SOURCE_APL_CDE,
        CONVERSION_IND,
        SOURCE_CONVERSION_IND,
        CONVERSION_EXPIRED_IND,
        CONVERSION_ELIGIBILITY_START_DT,
        CONVERTED_POLICY_TYPE_CDE,
        SOURCE_CONVERTED_POLICY_TYPE_CDE,
        CONVERTED_POLICY_NR_TXT,
        ACTIVITY_CDE,
        DELIVERY_DATA_CDE,
        SOURCE_DELIVERY_DATA_CDE,
        BENEFIT_AMT,
        DEATH_BENEFIT_OPTION_CDE,
        DEATH_BENEFIT_OPTION_INTEREST_RT,
        DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
        FACE_AMT,
        EXCHANGE_PROVISION_CDE,
        SOURCE_EXCHANGE_PROVISION_CDE,
        FREE_LOOK_EXPIRY_DT,
        INSURANCE_ANNUITY_CDE,
        SOURCE_INSURANCE_ANNUITY_CDE,
        LUMP_SUM_BENEFIT_AMT,
        MEC_EFFECTIVE_DT,
        MEC_CDE,
        SOURCE_MEC_CDE,
        MEC_STATUS_CDE,
        SOURCE_MEC_STATUS_CDE,
        NON_FORFEITURE_OPTION_CDE,
        ADMSPEC_CDE,
        SOURCE_ADMSPEC_CDE,
        PURPOSE_OF_INSURANCE_CATEGORY_CDE,
        PURPOSE_OF_INSURANCE_CDE,
        PEND_SETTLE_CDE,
        REINSURED_CDE,
        SOURCE_REINSURED_CDE,
        TEMPORARY_TERM_PRE_EFFECTIVE_DT,
        TEMPORARY_TERM_STATUS_CDE,
        YEARLY_TERM_PURCHASE_CDE,
        POLICY_LAPSE_DT,
        DBO_SHORT_NM,
        MEC_EFFECTIVE_DT_QUALITY_CDE,
        VLR_RC,
        TELEPHONE_AUTHORIZATION_CDE,
        TAX_AGG_CDE,
        SOURCE_TAX_AGG_CDE,
        TAX_AMT_NOT_DETERMINED_IND,
        ASSIGN_DT,
        EARLIEST_PERMITTED_ANNUITY_DT,
        LATEST_PERMITTED_ANNUITY_DT,
        SOURCE_TELEPHONE_AUTHORIZATION_CDE,
        WITHDRAWAL_OPTION_CDE,
        SOURCE_WITHDRAWAL_OPTION_CDE,
        GLWB_STATUS_CDE,
        SOURCE_GLWB_STATUS_CDE,
        GLWB_STATUS_DT,
        REINSURANCE_TREATY_NR_TXT,
        EXCESS_WITHDRAWAL_CDE,
        SOURCE_EXCESS_WITHDRAWAL_CDE,
        VI_RIDER_IND,
        PORTABILITY_IND,
		PERSISTENCY_CREDIT_CDE,
		SOURCE_PERSISTENCY_CREDIT_CDE,
		PERSISTENCY_CREDIT_START_DT,
		DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
        AGREEMENT_DIVIDEND_OPTION_CDE,
        SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
        AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
        AGREEMENT_DIVIDEND_OPTION_DESC,
        AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
        BEGIN_DT,
        BEGIN_DTM,
        ROW_PROCESS_DTM,
        AUDIT_ID,
        UPDATE_AUDIT_ID,
        LOGICAL_DELETE_IND,
        CHECK_SUM,
        CURRENT_ROW_IND,
        END_DT,
        END_DTM,
        SOURCE_SYSTEM_ID,
        RESTRICTED_ROW_IND
    )
SELECT
    SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID,
    SRC.AGREEMENT_NR_PFX,
    SRC.AGREEMENT_NR,
    SRC.AGREEMENT_NR_SFX,
    SRC.AGREEMENT_SOURCE_CDE,
    SRC.AGREEMENT_TYPE_CDE,
    SRC.AGREEMENT_STATUS_CDE,
    SRC.SOURCE_AGREEMENT_STATUS_CDE,
    SRC.AGREEMENT_STATUS_REASON_CDE,
    SRC.SOURCE_AGREEMENT_STATUS_REASON_CDE,
    SRC.AGREEMENT_STATUS_DT,
    SRC.DIM_PRODUCT_NATURAL_KEY_HASH_UUID,
    SRC.PT1_KIND_CDE,
    SRC.PT2_ISSUE_BASIS_CDE,
    SRC.PT3_RATE_CDE,
    SRC.AGREEMENT_EFFECTIVE_DT,
    SRC.ISSUE_DT,
    SRC.MATURITY_DT,
    SRC.ANNIVERSARY_DT,
    SRC.TERMINATION_DT,
    SRC.APPLICATION_RECEIVED_DT,
    SRC.APPLICATION_SIGNED_DT,
    SRC.CONVERSION_ELIGIBILITY_END_DT,
    SRC.MARKET_CATEGORY_TYPE_CDE,
    SRC.SOURCE_MARKET_CATEGORY_TYPE_CDE,
    SRC.TAX_QUALIFIED_CDE,
    SRC.SOURCE_TAX_QUALIFIED_CDE,
    SRC.SOURCE_PLAN_TYPE_CDE,
    SRC.REPLACEMENT_TYPE_CDE,
    SRC.SOURCE_REPLACEMENT_TYPE_CDE,
    SRC.RESTRICTION_CDE,
    SRC.SOURCE_RESTRICTION_CDE,
    SRC.RESTRICTION_CATEGORY_CDE,
    SRC.SOURCE_RESTRICTION_CATEGORY_CDE,
    SRC.COMPANY_CDE,
    SRC.SOURCE_COMPANY_CDE,
    SRC.FROZEN_CDE,
    SRC.SOURCE_FROZEN_CDE,
    SRC.HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SRC.SOURCE_HOME_OFFICE_AMOUNT_SUSPEND_CDE,
    SRC.LOST_INSURED_IND,
    SRC.SOURCE_LOST_INSURED_IND,
    SRC.TITLE_MESSAGE_TXT,
    SRC.OFFER_ACCEPTANCE_CDE,
    SRC.SOURCE_OFFER_ACCEPTANCE_CDE,
    SRC.VARIABLE_PRODUCT_CDE,
    SRC.CONTRACT_JURISDICTION_STATE_CDE,
    SRC.TAX_ACCOUNT_NR,
    SRC.READABILITY_CDE,
    SRC.VANTAGE_RESTRICTION_CDE,
    SRC.SOURCE_READABILITY_CDE,
    SRC.SUSPEND_CDE,
    SRC.SOURCE_SUSPEND_CDE,
    SRC.SOURCE_PRODUCT_SHORT_NM,
    SRC.SOURCE_PRODUCT_LONG_NM,
    SRC.SPECIAL_HANDLING_CDE,
    SRC.SOURCE_SPECIAL_HANDLING_CDE,
    SRC.ISSUE_REASON_CDE,
    SRC.SOURCE_ISSUE_REASON_CDE,
    SRC.CDSC_PERIOD_YEAR_NR,
    SRC.RENEWAL_DT,
    SRC.RETIRE_GUARD_IND,
    SRC.SOURCE_ADMIN_ERROR_CDE,
    SRC.SOURCE_PENDING_ACTIVITY_CDE,
    SRC.SOURCE_DELETE_IND,
    SRC.SOURCE_AGREEMENT_NR,
    SRC.WORKSITE_IND,
    SRC.PRODUCT_GROUP_CDE,
    SRC.UPDATE_STATE_CDE,
    SRC.AGENCY_SUSPEND_ITEM_CDE,
    SRC.SOURCE_PRODUCT_TYPE_CDE,
    SRC.DISTRIBUTOR_CLIENT_ACCOUNT_ID,
    SRC.RESIDENT_STATE_CDE,
    SRC.SOLICITATION_STATE_CDE,
    SRC.DISTRIBUTION_CHANNEL_CDE,
    SRC.SOURCE_DISTRIBUTION_CHANNEL_CDE,
    SRC.PRODUCT_TIER_CDE,
    SRC.REPLACEMENT_CDE,
    SRC.SOURCE_REPLACEMENT_CDE,
    SRC.SPECIAL_CONDITION_CDE,
    SRC.SPECIAL_CONDITION_CATEGORY_CDE,
    SRC.SPECIAL_CONDITION_REASON_CDE,
    SRC.SPECIAL_CONDITION_2_CDE,
    SRC.SPECIAL_CONDITION_2_CATEGORY_CDE,
    SRC.SPECIAL_CONDITION_2_REASON_CDE,
    SRC.SPM_GROUP_BILLED_SUSPENSE_IND,
    SRC.SPM_INDIVIDUAL_BILLED_SUSPENSE_IND,
    SRC.SPM_GROUP_AR_SUSPENSE_IND,
    SRC.ACTIVELY_AT_WORK_IND,
    SRC.MARKET_GROUP_CDE,
    SRC.PT_TRANS_TO_INSD_DT,
    SRC.MANAGERIAL_IND,
    SRC.INIT_PD_TO_DT,
    SRC.INSURED_INTERESTED_PARTY_NR_TXT,
    SRC.LIVING_BENEFIT_NOTICE_CDE,
    SRC.SOURCE_LIVING_BENEFIT_NOTICE_CDE,
    SRC.LIVING_BENEFIT_LOCK_IN_CDE,
    SRC.SOURCE_LIVING_BENEFIT_LOCK_IN_CDE,
    SRC.LIVING_BENEFIT_LOCK_IN_DT,
    SRC.ACTIVITY_PENDING_CDE,
    SRC.ACTIVITY_PENDING_DESC,
    SRC.SOURCE_ACTIVITY_PENDING_DESC,
    SRC.APD_IND,
    SRC.SOURCE_APD_IND,
    SRC.APM_NR_TXT,
    SRC.SOURCE_APM_NR_TXT,
    SRC.APL_CDE,
    SRC.SOURCE_APL_CDE,
    SRC.CONVERSION_IND,
    SRC.SOURCE_CONVERSION_IND,
    SRC.CONVERSION_EXPIRED_IND,
    SRC.CONVERSION_ELIGIBILITY_START_DT,
    SRC.CONVERTED_POLICY_TYPE_CDE,
    SRC.SOURCE_CONVERTED_POLICY_TYPE_CDE,
    SRC.CONVERTED_POLICY_NR_TXT,
    SRC.ACTIVITY_CDE,
    SRC.DELIVERY_DATA_CDE,
    SRC.SOURCE_DELIVERY_DATA_CDE,
    SRC.BENEFIT_AMT,
    SRC.DEATH_BENEFIT_OPTION_CDE,
    SRC.DEATH_BENEFIT_OPTION_INTEREST_RT,
    SRC.DEATH_BENEFIT_OPTION_INTEREST_RT_QUALITY_CDE,
    SRC.FACE_AMT,
    SRC.EXCHANGE_PROVISION_CDE,
    SRC.SOURCE_EXCHANGE_PROVISION_CDE,
    SRC.FREE_LOOK_EXPIRY_DT,
    SRC.INSURANCE_ANNUITY_CDE,
    SRC.SOURCE_INSURANCE_ANNUITY_CDE,
    SRC.LUMP_SUM_BENEFIT_AMT,
    SRC.MEC_EFFECTIVE_DT,
    SRC.MEC_CDE,
    SRC.SOURCE_MEC_CDE,
    SRC.MEC_STATUS_CDE,
    SRC.SOURCE_MEC_STATUS_CDE,
    SRC.NON_FORFEITURE_OPTION_CDE,
    SRC.ADMSPEC_CDE,
    SRC.SOURCE_ADMSPEC_CDE,
    SRC.PURPOSE_OF_INSURANCE_CATEGORY_CDE,
    SRC.PURPOSE_OF_INSURANCE_CDE,
    SRC.PEND_SETTLE_CDE,
    SRC.REINSURED_CDE,
    SRC.SOURCE_REINSURED_CDE,
    SRC.TEMPORARY_TERM_PRE_EFFECTIVE_DT,
    SRC.TEMPORARY_TERM_STATUS_CDE,
    SRC.YEARLY_TERM_PURCHASE_CDE,
    SRC.POLICY_LAPSE_DT,
    SRC.DBO_SHORT_NM,
    SRC.MEC_EFFECTIVE_DT_QUALITY_CDE,
    SRC.VLR_RC,
    SRC.TELEPHONE_AUTHORIZATION_CDE,
    SRC.TAX_AGG_CDE,
    SRC.SOURCE_TAX_AGG_CDE,
    SRC.TAX_AMT_NOT_DETERMINED_IND,
    SRC.ASSIGN_DT,
    SRC.EARLIEST_PERMITTED_ANNUITY_DT,
    SRC.LATEST_PERMITTED_ANNUITY_DT,
    SRC.SOURCE_TELEPHONE_AUTHORIZATION_CDE,
    SRC.WITHDRAWAL_OPTION_CDE,
    SRC.SOURCE_WITHDRAWAL_OPTION_CDE,
    SRC.GLWB_STATUS_CDE,
    SRC.SOURCE_GLWB_STATUS_CDE,
    SRC.GLWB_STATUS_DT,
    SRC.REINSURANCE_TREATY_NR_TXT,
    SRC.EXCESS_WITHDRAWAL_CDE,
    SRC.SOURCE_EXCESS_WITHDRAWAL_CDE,
    SRC.VI_RIDER_IND,
    SRC.PORTABILITY_IND,
	SRC.PERSISTENCY_CREDIT_CDE,
	SRC.SOURCE_PERSISTENCY_CREDIT_CDE,
	SRC.PERSISTENCY_CREDIT_START_DT,
	SRC.DEATH_BENEFIT_OPTION_CHANGE_AGE_NR,
    SRC.AGREEMENT_DIVIDEND_OPTION_CDE,
    SRC.SOURCE_AGREEMENT_DIVIDEND_OPTION_CDE,
    SRC.AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SRC.SOURCE_AGREEMENT_SECOND_DIVIDEND_OPTION_CDE,
    SRC.AGREEMENT_DIVIDEND_OPTION_DESC,
    SRC.AGREEMENT_SECOND_DIVIDEND_OPTION_DESC,
    SRC.BEGIN_DT::DATE AS BEGIN_DT,
    SRC.BEGIN_DT::TIMESTAMP  BEGIN_DTM,
    CURRENT_TIMESTAMP(6) AS ROW_PROCESS_DTM,
    :RUN_ID AS AUDIT_ID,
    :RUN_ID AS UPDATE_AUDIT_ID,
    FALSE AS LOGICAL_DELETE_IND,
    SRC.CHECK_SUM AS CHECK_SUM,
    TRUE AS CURRENT_ROW_IND,
    '9999-12-31'::DATE AS END_DT,
    '9999-12-31'::TIMESTAMP  AS END_DTM,
    266 AS SOURCE_SYSTEM_ID,
    FALSE AS RESTRICTED_ROW_IND
FROM EDW_STAGING.AIFRPS_DIM_AGREEMENT_INITIAL_LOAD_PRE_WORK SRC
LEFT JOIN EDW_TDSUNSET.DIM_AGREEMENT_INITIAL_AIF_RPS TGT
ON SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID = TGT.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID
AND TGT.CURRENT_ROW_IND = TRUE /*AND TGT.SOURCE_SYSTEM_ID = 241 */
WHERE
(TGT.ROW_SID IS NULL AND SRC.DIM_AGREEMENT_NATURAL_KEY_HASH_UUID
 IN (SELECT DISTINCT DIM_AGREEMENT_NATURAL_KEY_HASH_UUID FROM EDW_TDSUNSET.DIM_AGREEMENT_INITIAL_AIF_RPS))
OR
(TGT.ROW_SID IS NOT NULL  AND
(SRC.CHECK_SUM <> TGT.CHECK_SUM));
